<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Vue-Router api | 王小明</title><meta name="description" content="vue-router api 阅读"><meta name="keywords" content="learn,vueRouter"><meta name="author" content="Decade W"><meta name="copyright" content="Decade W"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><script src="https://code.jquery.com/jquery-3.4.1.min.js"></script><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Vue-Router api"><meta name="twitter:description" content="vue-router api 阅读"><meta name="twitter:image" content="http://blog.decade.run/img/coverimg/vue.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Vue-Router api"><meta property="og:url" content="http://blog.decade.run/2021/05/09/Vue-Router-api/"><meta property="og:site_name" content="王小明"><meta property="og:description" content="vue-router api 阅读"><meta property="og:image" content="http://blog.decade.run/img/coverimg/vue.jpg"><meta property="article:published_time" content="2021-05-09T12:33:58.000Z"><meta property="article:modified_time" content="2021-05-09T12:35:42.468Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://blog.decade.run/2021/05/09/Vue-Router-api/"><link rel="next" title="vue3 源码阅读 watch" href="http://blog.decade.run/2021/04/28/vue3-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E4%B8%89/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"LEP83554SS","apiKey":"96fa18c62f7619e2bf35df83ba4aef39","indexName":"...","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":0,"translateDelay":1,"cookieDomain":"https://blog.decade.run/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: Decade W","link":"链接: ","source":"来源: 王小明","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: {"text":"努力,学习","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="王小明" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">55</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">17</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item Home"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item Archives"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item Tag"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tag</span></a></div><div class="menus_item Categories"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item Link"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item About"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#API-参考"><span class="toc-number">1.</span> <span class="toc-text">API 参考</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#router-link-Props"><span class="toc-number">1.1.</span> <span class="toc-text">router-link Props</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#to"><span class="toc-number">1.1.1.</span> <span class="toc-text">to</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#replace"><span class="toc-number">1.1.2.</span> <span class="toc-text">replace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#active-class"><span class="toc-number">1.1.3.</span> <span class="toc-text">active-class</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#aria-current-value"><span class="toc-number">1.1.4.</span> <span class="toc-text">aria-current-value</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#costom"><span class="toc-number">1.1.5.</span> <span class="toc-text">costom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exact-active-class"><span class="toc-number">1.1.6.</span> <span class="toc-text">exact-active-class</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#router-link-的-v-slot"><span class="toc-number">1.2.</span> <span class="toc-text">router-link   的   v-slot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#router-link-源码"><span class="toc-number">1.3.</span> <span class="toc-text">router-link 源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#router-view-Props"><span class="toc-number">1.4.</span> <span class="toc-text">router-view Props</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#name"><span class="toc-number">1.4.1.</span> <span class="toc-text">name</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#route"><span class="toc-number">1.4.2.</span> <span class="toc-text">route</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#router-view-的-v-slot"><span class="toc-number">1.4.3.</span> <span class="toc-text">router-view 的 v-slot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#router-view源码"><span class="toc-number">1.4.4.</span> <span class="toc-text">router-view源码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#createRouter"><span class="toc-number">1.5.</span> <span class="toc-text">createRouter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#createRouter-源码"><span class="toc-number">1.5.1.</span> <span class="toc-text">createRouter 源码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#useCallbacks"><span class="toc-number">1.5.2.</span> <span class="toc-text">useCallbacks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#applyToParams"><span class="toc-number">1.5.3.</span> <span class="toc-text">applyToParams</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NavigationFailureType"><span class="toc-number">1.6.</span> <span class="toc-text">NavigationFailureType</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#START-LOCATION"><span class="toc-number">1.6.1.</span> <span class="toc-text">START_LOCATION</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CompositionApi"><span class="toc-number">1.7.</span> <span class="toc-text">CompositionApi</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#onBeforeRouteLeave"><span class="toc-number">1.7.1.</span> <span class="toc-text">onBeforeRouteLeave</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#onBeforeRouteUpdate"><span class="toc-number">1.7.2.</span> <span class="toc-text">onBeforeRouteUpdate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#useLink"><span class="toc-number">1.7.3.</span> <span class="toc-text">useLink</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#useRoute"><span class="toc-number">1.7.4.</span> <span class="toc-text">useRoute</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#userRouter"><span class="toc-number">1.7.5.</span> <span class="toc-text">userRouter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Router-方法"><span class="toc-number">1.8.</span> <span class="toc-text">Router 方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#addRoute"><span class="toc-number">1.8.1.</span> <span class="toc-text">addRoute</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div class="post-bg" id="nav" style="background-image: url(/img/coverimg/vue.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">王小明</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item Home"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item Archives"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item Tag"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tag</span></a></div><div class="menus_item Categories"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item Link"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item About"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Vue-Router api</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-05-09 20:33:58"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-05-09</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-05-09 20:35:42"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-05-09</span></time></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">6.4k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 30 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2021/05/09/Vue-Router-api/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2021/05/09/Vue-Router-api/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h2 id="API-参考"><a href="#API-参考" class="headerlink" title="API 参考"></a>API 参考</h2><h3 id="router-link-Props"><a href="#router-link-Props" class="headerlink" title="router-link Props"></a>router-link Props</h3><h4 id="to"><a href="#to" class="headerlink" title="to"></a>to</h4><ul>
<li><p>类型 :  <code>RouteLocationRaw</code></p>
</li>
<li><p>详细内容</p>
<p>表示目标路由的链接, 当被点击后, 内部会立刻把 <code>to</code> 的值传到 <code>router.push()</code>, 所以这个值可以是一个 <code>string</code> 或者是描述目标位置的对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 字符串 --&gt;</span><br><span class="line">&lt;router-link to&#x3D;&quot;&#x2F;home&quot;&gt;Home&lt;&#x2F;router-link&gt;</span><br><span class="line">&lt;!-- 渲染结果 --&gt;</span><br><span class="line">&lt;a href&#x3D;&quot;&#x2F;home&quot;&gt;Home&lt;&#x2F;a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 使用 v-bind 的 JS 表达式 --&gt;</span><br><span class="line">&lt;router-link :to&#x3D;&quot;&#39;&#x2F;home&#39;&quot;&gt;Home&lt;&#x2F;router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 同上 --&gt;</span><br><span class="line">&lt;router-link :to&#x3D;&quot;&#123; path: &#39;&#x2F;home&#39; &#125;&quot;&gt;Home&lt;&#x2F;router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 命名的路由 --&gt;</span><br><span class="line">&lt;router-link :to&#x3D;&quot;&#123; name: &#39;user&#39;, params: &#123; userId: &#39;123&#39; &#125;&#125;&quot;&gt;User&lt;&#x2F;router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 带查询参数，下面的结果为 &#96;&#x2F;register?plan&#x3D;private&#96; --&gt;</span><br><span class="line">&lt;router-link :to&#x3D;&quot;&#123; path: &#39;&#x2F;register&#39;, query: &#123; plan: &#39;private&#39; &#125;&#125;&quot;&gt;</span><br><span class="line">  Register</span><br><span class="line">&lt;&#x2F;router-link&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h4><ul>
<li><p>类型:  <code>boolean</code></p>
</li>
<li><p>默认值:  <code>false</code></p>
</li>
<li><p>详细内容</p>
<p>设置 <code>replace</code> 属性的话, 当点击时, 会调用 <code>router.replace()</code>, 而不是 <code>router.push()</code>, 所以导航后不会留下历史记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link to&#x3D;&quot;&#x2F;abc&quot; replace&gt;&lt;&#x2F;router-link&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="active-class"><a href="#active-class" class="headerlink" title="active-class"></a>active-class</h4><ul>
<li><p>类型:  <code>string</code></p>
</li>
<li><p>默认值:  <code>&quot;router-link-active&quot;</code> 或者全局 <code>linkActiveClass</code> </p>
</li>
<li><p>详细内容</p>
<p>链接激活时，应用于渲染的 <code>&lt;a&gt;</code> 的 class</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link to&#x3D;&quot;&#x2F;&quot; active-class&#x3D;&quot;myActiveClass&quot;&gt;customLink&lt;&#x2F;router-link&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  linkActiveClass: <span class="string">'customLinkActiveClass'</span>, <span class="comment">// 全局自定义 </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="aria-current-value"><a href="#aria-current-value" class="headerlink" title="aria-current-value"></a>aria-current-value</h4><ul>
<li><p>类型  <code>&#39;page&#39; | &#39;step&#39; | &#39;location&#39; | &#39;date&#39; | &#39;time&#39; | &#39;true&#39; | &#39;false&#39;</code></p>
</li>
<li><p>默认值:  <code>&#39;page&#39;</code></p>
</li>
<li><p>详细内容</p>
<p>当链接激活时, 传递给属性 <code>aria-current</code> 的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link to&#x3D;&quot;&#x2F;&quot; active-class&#x3D;&quot;myActiveClass&quot;&gt;customLink&lt;&#x2F;router-link&gt;</span><br><span class="line">&lt;!-- 相当于 --&gt;</span><br><span class="line">&lt;a href&#x3D;&quot;&#x2F;&quot; class&#x3D;&quot;myActiveClass router-link-exact-active&quot; aria-current&#x3D;&quot;page&quot;&gt;customLink&lt;&#x2F;a&gt;</span><br><span class="line"></span><br><span class="line">&lt;router-link to&#x3D;&quot;&#x2F;&quot; aria-current-value&#x3D;&quot;step&quot;&gt;customLink&lt;&#x2F;router-link&gt;</span><br><span class="line">&lt;!-- 相当于 --&gt;</span><br><span class="line">&lt;a href&#x3D;&quot;&#x2F;&quot; class&#x3D;&quot;router-link-active router-link-exact-active&quot; aria-current&#x3D;&quot;step&quot;&gt;customLink&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="costom"><a href="#costom" class="headerlink" title="costom"></a>costom</h4><ul>
<li><p>类型:  <code>boolean</code></p>
</li>
<li><p>默认值:  <code>false</code></p>
</li>
<li><p>详细内容</p>
<p><code>&lt;router-link&gt;</code> 是否应该将其内容包裹在 <code>&lt;a&gt;</code> 元素中, 在使用 <code>v-slot</code> 创建自定义 RouterLink 时很有用, 默认情况下, <code>&lt;router-link&gt;</code> 会将其内容包裹在 <code>&lt;a&gt;</code> 元素中, 即使使用 <code>v-slot</code> 也是如此, 传递<code>自定义的</code> prop, 可以去除这种行为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link</span><br><span class="line">    to&#x3D;&quot;&#x2F;home&quot;</span><br><span class="line">    custom</span><br><span class="line">    v-slot&#x3D;&quot;&#123; route, navigate&#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;li</span><br><span class="line">      @click&#x3D;&quot;navigate&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &#123;&#123; route.fullPath &#125;&#125;</span><br><span class="line">    &lt;&#x2F;li&gt;</span><br><span class="line">  &lt;&#x2F;router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 相当于 --&gt;</span><br><span class="line">&lt;li&gt;&#x2F;home&lt;&#x2F;li&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="exact-active-class"><a href="#exact-active-class" class="headerlink" title="exact-active-class"></a>exact-active-class</h4><ul>
<li><p>类型:  <code>string</code></p>
</li>
<li><p>默认值:  <code>&quot;router-link-exact-active&quot;</code> 全局 <code>linkExactActiveClass</code></p>
</li>
<li><p>详细内容</p>
<p>链接精准激活时, 应用于渲染的 <code>&lt;a&gt;</code> 的 class</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link to&#x3D;&quot;&#x2F;&quot; exact-active-class&#x3D;&quot;exactActiveClass&quot;&gt;xxx&lt;&#x2F;router-link&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  linkExactActiveClass: <span class="string">'linkExactActiveClass'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>渲染成</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span> <span class="attr">class</span>=<span class="string">"router-link-active exactActiveClass"</span> <span class="attr">aria-current</span>=<span class="string">"page"</span>&gt;</span>customLink<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="router-link-的-v-slot"><a href="#router-link-的-v-slot" class="headerlink" title="router-link   的   v-slot"></a>router-link   的   v-slot</h3><p><code>&lt;router-link&gt;</code> 通过一个作用域插槽暴露底层的定制能力, 这是一个更高阶的 API, 主要面向库作者, 但也可以为开发者提供便利, 大多数情况下用在一个类似 <em>NavLink</em> 这样的组件里</p>
<blockquote>
<p>注意</p>
<p>记得把 <code>custom</code> 配置传递给 <code>&lt;router-link&gt;</code>, 以防止它将内容包裹在 <code>&lt;a&gt;</code> 元素内</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link</span><br><span class="line">  to&#x3D;&quot;&#x2F;about&quot;</span><br><span class="line">  custom</span><br><span class="line">  v-slot&#x3D;&quot;&#123; href, route, navigate, isActive, isExactActive &#125;&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;NavLink :active&#x3D;&quot;isActive&quot; :href&#x3D;&quot;href&quot; @click&#x3D;&quot;navigate&quot;&gt;</span><br><span class="line">    &#123;&#123; route.fullPath &#125;&#125;</span><br><span class="line">  &lt;&#x2F;NavLink&gt;</span><br><span class="line">&lt;&#x2F;router-link&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>href</code>：解析后的 URL, 将会作为一个 <code>&lt;a&gt;</code> 元素的 <code>href</code> 属性, 如果什么都没提供, 则它会包含 <code>base</code></li>
<li><code>route</code>：解析后的规范化的地址</li>
<li><code>navigate</code>：触发导航的函数,  <strong>会在必要时自动阻止事件</strong>, 和 <code>router-link</code> 一样, 例如：<code>ctrl</code> 或者 <code>cmd</code> + 点击仍然会被 <code>navigate</code> 忽略</li>
<li><code>isActive</code>：如果需要应用 active class, 则为 <code>true</code>, 允许应用一个任意的 class</li>
<li><code>isExactActive</code>：如果需要应用 exact active class，则为 <code>true</code>, 允许应用一个任意的 class</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link</span><br><span class="line">  to&#x3D;&quot;&#x2F;about&quot;</span><br><span class="line">  custom</span><br><span class="line">  v-slot&#x3D;&quot;&#123; route, navigate, href&#125;&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;a</span><br><span class="line">    :href&#x3D;&quot;href&quot;</span><br><span class="line">    target&#x3D;&quot;_blank&quot;</span><br><span class="line">  &gt;</span><br><span class="line">  &#123;&#123; route.fullPath &#125;&#125;</span><br><span class="line">  &lt;&#x2F;a&gt;</span><br><span class="line">&lt;&#x2F;router-link&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示</p>
<p>如果你在 <code>a</code> 元素上添加一个 <code>target=&quot;_blank&quot;</code>, 你必须省略 <code>@click=&quot;navigate&quot;</code> 的处理</p>
</blockquote>
<h3 id="router-link-源码"><a href="#router-link-源码" class="headerlink" title="router-link 源码"></a>router-link 源码</h3><p><code>src/RouterLink.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router-link props</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> RouterLinkOptions &#123;</span><br><span class="line">  to: RouteLocationRaw <span class="comment">// 跳转</span></span><br><span class="line">  replace?: <span class="built_in">boolean</span> <span class="comment">// 是否启用 router.replace 代替 router.push</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// router-link props</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> RouterLinkProps <span class="keyword">extends</span> RouterLinkOptions &#123;</span><br><span class="line">  custom?: <span class="built_in">boolean</span> <span class="comment">// 是否用户自定义 </span></span><br><span class="line">  activeClass?: <span class="built_in">string</span> <span class="comment">// 激活路由的样式</span></span><br><span class="line">  exactActiveClass?: <span class="built_in">string</span> <span class="comment">// 精确路由的激活样式</span></span><br><span class="line">  ariaCurrentValue?: <span class="comment">// a标签上的 aria-current的值</span></span><br><span class="line">    | <span class="string">'page'</span></span><br><span class="line">    | <span class="string">'step'</span></span><br><span class="line">    | <span class="string">'location'</span></span><br><span class="line">    | <span class="string">'date'</span></span><br><span class="line">    | <span class="string">'time'</span></span><br><span class="line">    | <span class="string">'true'</span></span><br><span class="line">    | <span class="string">'false'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> UseLinkOptions = VueUseOptions&lt;RouterLinkOptions&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// useLink hook</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useLink</span>(<span class="params">props: UseLinkOptions</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> router = inject(routerKey)! <span class="comment">// 获取 router 这个router 就是 我们调用 createRouter生成的那个router</span></span><br><span class="line">  <span class="keyword">const</span> currentRoute = inject(routeLocationKey)! <span class="comment">// 获取当前路由</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> route = computed(<span class="function"><span class="params">()</span> =&gt;</span> router.resolve(unref(props.to))) <span class="comment">// 计算属性 计算route</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 计算属性 route 在 record 中的index</span></span><br><span class="line">  <span class="keyword">const</span> activeRecordIndex = computed&lt;<span class="built_in">number</span>&gt;<span class="function">(<span class="params">(<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">let</span> &#123; matched &#125; = route.value</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">let</span> &#123; length &#125; = matched</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> routeMatched: RouteRecord | <span class="literal">undefined</span> = matched[length - 1]</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">let</span> currentMatched = currentRoute.matched</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">if</span> (<span class="params">!routeMatched || !currentMatched.length</span>) <span class="keyword">return</span> -1</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">let</span> index = currentMatched.findIndex(<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      isSameRouteRecord.bind(<span class="params"><span class="literal">null</span>, routeMatched</span>)</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    </span>)</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">if</span> (<span class="params">index &gt; -1</span>) <span class="keyword">return</span> index</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">// possible parent record</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">let</span> parentRecordPath = getOriginalPath(<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      matched[length - 2] <span class="keyword">as</span> RouteRecord | <span class="literal">undefined</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    </span>)</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> (<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      <span class="comment">// we are dealing with nested routes</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      length &gt; 1 &amp;&amp;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="comment">// if the parent and matched route have the same path, this link is</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="comment">// referring to the empty child. Or we currently are on a different</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="comment">// child of the same parent</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        getOriginalPath(<span class="params">routeMatched</span>) === parentRecordPath &amp;&amp;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="comment">// avoid comparing the child with its parent</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        currentMatched[currentMatched.length - 1].path !== parentRecordPath</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        ? currentMatched.findIndex(<span class="params"></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">            isSameRouteRecord.bind(<span class="params"><span class="literal">null</span>, matched[length - 2]</span>)</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">          </span>)</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        : index</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    </span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // 计算属性 是否是 <span class="params">active</span></span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">isActive</span> = <span class="params">computed</span>&lt;<span class="params">boolean</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    (<span class="params"></span>) =&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">      activeRecordIndex.value &gt; -1 &amp;&amp;</span></span></span><br><span class="line"><span class="function"><span class="params">      includesParams(<span class="params">currentRoute.params, route.value.params</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>)</span></span><br><span class="line"><span class="function">  // 计算属性 是否是 <span class="params">exactActive</span></span></span><br><span class="line"><span class="function">  <span class="params">const</span> <span class="params">isExactActive</span> = <span class="params">computed</span>&lt;<span class="params">boolean</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    (<span class="params"></span>) =&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">      activeRecordIndex.value &gt; -1 &amp;&amp;</span></span></span><br><span class="line"><span class="function"><span class="params">      activeRecordIndex.value === currentRoute.matched.length - 1 &amp;&amp;</span></span></span><br><span class="line"><span class="function"><span class="params">      isSameRouteLocationParams(<span class="params">currentRoute.params, route.value.params</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // 跳转的方法 <span class="params">navigate</span></span></span><br><span class="line"><span class="function">  <span class="params">function</span> <span class="params">navigate</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    e: MouseEvent = &#123;&#125; <span class="keyword">as</span> MouseEvent</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="params">Promise</span>&lt;<span class="params">void</span> | <span class="params">NavigationFailure</span>&gt; &#123;</span></span><br><span class="line"><span class="function">    <span class="params">if</span> (<span class="params">guardEvent(<span class="params">e</span>)</span>)</span></span><br><span class="line"><span class="function">      <span class="params">return</span> <span class="params">router</span>[<span class="params">unref</span>(<span class="params">props.replace</span>) ? '<span class="params">replace</span>' : '<span class="params">push</span>'](<span class="params">unref(<span class="params">props.to</span>)</span>)</span></span><br><span class="line"><span class="function">    <span class="params">return</span> <span class="params">Promise</span>.<span class="params">resolve</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="params">return</span> &#123;</span></span><br><span class="line"><span class="function">    <span class="params">route</span>,</span></span><br><span class="line"><span class="function">    <span class="params">href</span>: <span class="params">computed</span>(<span class="params">(<span class="params"></span>) =&gt; route.value.href</span>),</span></span><br><span class="line"><span class="function">    <span class="params">isActive</span>,</span></span><br><span class="line"><span class="function">    <span class="params">isExactActive</span>,</span></span><br><span class="line"><span class="function">    <span class="params">navigate</span>,</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// <span class="params">routerLink</span> 组件</span></span><br><span class="line"><span class="function"><span class="params">export</span> <span class="params">const</span> <span class="params">RouterLinkImpl</span> = /*#__<span class="params">PURE__</span>*/ <span class="params">defineComponent</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// 组件名称</span></span></span></span><br><span class="line"><span class="function"><span class="params">  name: 'RouterLink',</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">// 传入的props</span></span></span></span><br><span class="line"><span class="function"><span class="params">  props: &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    to: &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">type</span>: [<span class="built_in">String</span>, <span class="built_in">Object</span>] <span class="keyword">as</span> PropType&lt;RouteLocationRaw&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">      required: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">    replace: <span class="built_in">Boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    activeClass: <span class="built_in">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">// inactiveClass: String,</span></span></span></span><br><span class="line"><span class="function"><span class="params">    exactActiveClass: <span class="built_in">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    custom: <span class="built_in">Boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    ariaCurrentValue: &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">type</span>: <span class="built_in">String</span> <span class="keyword">as</span> PropType&lt;RouterLinkProps['ariaCurrentValue']&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">default</span>: 'page',</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  setup(<span class="params">props, &#123; slots &#125;</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> link = reactive(<span class="params">useLink(<span class="params">props</span>)</span>) <span class="comment">// 返回的link 包含 route href isActive isExactActive navigate</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> &#123; options &#125; = inject(<span class="params">routerKey</span>)! <span class="comment">// 取出 route的options , 这里的options 就是我们 调用 createRouter传入的那个对象</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">// 计算属性 元素的class</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> elClass = computed(<span class="params">(<span class="params"></span>) =&gt; (<span class="params">&#123;</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">      [getLinkClass(<span class="params"></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params"><span class="params">        props.activeClass, <span class="comment">// 如果 routerLink中 传入activeClass 就用这个样式</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params"><span class="params">        options.linkActiveClass, <span class="comment">// routerLink中没有传入 但是 在createRouter传入的那个options 定义了linkActiveClass 就用这个</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params"><span class="params">        'router-link-active' <span class="comment">// 默认样式</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params"><span class="params">      </span>)]: link.isActive,</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">      [getLinkClass(<span class="params"></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params"><span class="params">        props.exactActiveClass, <span class="comment">// 如果 routerLink中 传入exactActiveClass就用这个样式</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params"><span class="params">        options.linkExactActiveClass, <span class="comment">// routerLink中没有传入 但是 在createRouter传入的那个options 定义了linkExactActiveClass 就用这个</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params"><span class="params">        'router-link-exact-active' <span class="comment">// 默认样式</span></span></span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params"><span class="params">      </span>)]: link.isExactActive,</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params"><span class="params">    &#125;</span>)</span>)</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">// 开发环境 或者 支持 props的 开发工具 且 是在 浏览器下</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">if</span> (<span class="params">(<span class="params">__DEV__ || __FEATURE_PROD_DEVTOOLS__</span>) &amp;&amp; __BROWSER__</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">const</span> instance = getCurrentInstance(<span class="params"></span>) <span class="comment">// 获取当前实例</span></span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="comment">// 使用 watchEffect</span></span></span></span><br><span class="line"><span class="function"><span class="params">      watchEffect(<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        (<span class="params"></span>) =&gt; &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">if</span> (<span class="params">!instance</span>) <span class="keyword">return</span> <span class="comment">// 不存在 当前实例 返回</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          ;(<span class="params">instance <span class="keyword">as</span> <span class="built_in">any</span></span>).__vrl_route = link.route <span class="comment">// 否则就给 instance.__vrl_route赋值</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        &#125;,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        &#123; flush: 'post' &#125; <span class="comment">// post 队列</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      </span>)</span></span></span><br><span class="line"><span class="function"><span class="params">      watchEffect(<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        (<span class="params"></span>) =&gt; &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          <span class="keyword">if</span> (<span class="params">!instance</span>) <span class="keyword">return</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          ;(<span class="params">instance <span class="keyword">as</span> <span class="built_in">any</span></span>).__vrl_active = link.isActive</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          ;(<span class="params">instance <span class="keyword">as</span> <span class="built_in">any</span></span>).__vrl_exactActive = link.isExactActive</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        &#125;,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        &#123; flush: 'post' &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      </span>)</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">   <span class="comment">// 如果 setup方法的执行结果 返回的是一个方法 将会作为一个render方法</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">const</span> children = slots.<span class="keyword">default</span> &amp;&amp; slots.<span class="keyword">default</span>(<span class="params">link</span>) <span class="comment">// 存在 v-slot</span></span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">return</span> props.custom <span class="comment">// 如果是用户 自定义 就用插槽 否则用默认的 h方法</span></span></span></span><br><span class="line"><span class="function"><span class="params">        ? children</span></span></span><br><span class="line"><span class="function"><span class="params">      	<span class="comment">// 否则用默认的 h方法 创建一个 a标签</span></span></span></span><br><span class="line"><span class="function"><span class="params">        : h(<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            'a',</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        		<span class="comment">// 定义属性</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">              'aria-current': link.isExactActive</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">                ? props.ariaCurrentValue</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">                : <span class="literal">null</span>,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">              href: link.href,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">              onClick: link.navigate, <span class="comment">// 点击事件 触发navigate 方法</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">              <span class="keyword">class</span>: elClass.value,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            &#125;,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        		<span class="comment">// 放入 children</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">            children</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">          </span>)</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="router-view-Props"><a href="#router-view-Props" class="headerlink" title="router-view Props"></a>router-view Props</h3><h4 id="name"><a href="#name" class="headerlink" title="name"></a>name</h4><ul>
<li><p>类型:  <code>string</code></p>
</li>
<li><p>默认值:  <code>default</code></p>
</li>
<li><p>详细内容</p>
<p>如果 <code>&lt;router-view&gt;</code> 设置了 <code>name</code>, 则会渲染对应的路由配置中 <code>components</code> 下的相应组件</p>
</li>
<li><p>命名视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-view class&#x3D;&quot;view left-sidebar&quot; name&#x3D;&quot;LeftSidebar&quot;&gt;&lt;&#x2F;router-view&gt;</span><br><span class="line">&lt;router-view class&#x3D;&quot;view main-content&quot;&gt;&lt;&#x2F;router-view&gt;</span><br><span class="line">&lt;router-view class&#x3D;&quot;view right-sidebar&quot; name&#x3D;&quot;RightSidebar&quot;&gt;&lt;&#x2F;router-view&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/'</span>,</span><br><span class="line">    components: &#123;</span><br><span class="line">      <span class="keyword">default</span>: Home,</span><br><span class="line">      <span class="comment">// LeftSidebar: LeftSidebar 的缩写</span></span><br><span class="line">      LeftSidebar,</span><br><span class="line">      <span class="comment">// 它们与 `&lt;router-view&gt;` 上的 `name` 属性匹配</span></span><br><span class="line">      RightSidebar,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  history: createWebHashHistory(),</span><br><span class="line">  routes,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="route"><a href="#route" class="headerlink" title="route"></a>route</h4><ul>
<li><p>类型:  <code>RouteLocationNormalized</code></p>
</li>
<li><p>详细内容</p>
<p>一个路由地址的所有组件都已被解析（如果所有组件都被懒加载），因此可以显示</p>
</li>
</ul>
<h4 id="router-view-的-v-slot"><a href="#router-view-的-v-slot" class="headerlink" title="router-view 的 v-slot"></a>router-view 的 v-slot</h4><p><code>&lt;router-view&gt;</code> 暴露了一个 <code>v-slot</code> API, 主要使用 <code>&lt;transition&gt;</code> 和 <code>&lt;keep-alive&gt;</code> 组件来包裹你的路由组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-view v-slot&#x3D;&quot;&#123; Component, route &#125;&quot;&gt;</span><br><span class="line">  &#123;&#123; route &#125;&#125;</span><br><span class="line">  &lt;component :is&#x3D;&quot;Component&quot;&gt;&lt;&#x2F;component&gt;</span><br><span class="line">&lt;&#x2F;router-view&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Component</code>: 要传递给 <code>&lt;component&gt;</code> 的 VNodes <code>是</code> prop</li>
<li><code>route</code>: 解析出的标准化路由地址</li>
</ul>
<h4 id="router-view源码"><a href="#router-view源码" class="headerlink" title="router-view源码"></a>router-view源码</h4><p><code>src/RouterView.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router-view 的props</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> RouterViewProps &#123;</span><br><span class="line">  name?: <span class="built_in">string</span> <span class="comment">// 命名视图</span></span><br><span class="line">  route?: RouteLocationNormalized  <span class="comment">// 完成的路由信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// router-view 组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RouterViewImpl = <span class="comment">/*#__PURE__*/</span> defineComponent(&#123;</span><br><span class="line">  name: <span class="string">'RouterView'</span>, <span class="comment">// 组件名称</span></span><br><span class="line">  inheritAttrs: <span class="literal">false</span>, <span class="comment">// 没有继承样式啥的</span></span><br><span class="line">  <span class="comment">// 属性</span></span><br><span class="line">  props: &#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">String</span> <span class="keyword">as</span> PropType&lt;<span class="built_in">string</span>&gt;,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">'default'</span>,  <span class="comment">// 默认 default</span></span><br><span class="line">    &#125;,</span><br><span class="line">    route: <span class="built_in">Object</span> <span class="keyword">as</span> PropType&lt;RouteLocationNormalizedLoaded&gt;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// setup 方法</span></span><br><span class="line">  setup(props, &#123; attrs, slots &#125;) &#123;</span><br><span class="line">    __DEV__ &amp;&amp; warnDeprecatedUsage() <span class="comment">// 开发环境下 检测父节点 是不是 keepAlive 或者 transtion </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> injectedRoute = inject(routerViewLocationKey)! <span class="comment">// 取出注入的 route</span></span><br><span class="line">    <span class="keyword">const</span> routeToDisplay = computed(<span class="function"><span class="params">()</span> =&gt;</span> props.route || injectedRoute.value) <span class="comment">//  展示路由 props 传入的 route 还是 注入的route的route</span></span><br><span class="line">    <span class="keyword">const</span> depth = inject(viewDepthKey, <span class="number">0</span>) <span class="comment">// 深度</span></span><br><span class="line">    <span class="comment">// 匹配的route</span></span><br><span class="line">    <span class="keyword">const</span> matchedRouteRef = computed&lt;RouteLocationMatched | <span class="literal">undefined</span>&gt;(</span><br><span class="line">      () =&gt; routeToDisplay.value.matched[depth]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    provide(viewDepthKey, depth + <span class="number">1</span>) <span class="comment">// 修改深度</span></span><br><span class="line">    provide(matchedRouteKey, matchedRouteRef) <span class="comment">// 修改匹配的路由</span></span><br><span class="line">    provide(routerViewLocationKey, routeToDisplay) <span class="comment">// 修改当前展示的路由</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> viewRef = ref&lt;ComponentPublicInstance&gt;()</span><br><span class="line">		</span><br><span class="line">    <span class="comment">// 视图变化, 路由变化, 名字变化 都会触发watch</span></span><br><span class="line">    watch(</span><br><span class="line">      () =&gt; [viewRef.value, matchedRouteRef.value, props.name] <span class="keyword">as</span> <span class="keyword">const</span>,</span><br><span class="line">      ([instance, to, name], [oldInstance, <span class="keyword">from</span>, oldName]) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (to) &#123;</span><br><span class="line">          to.instances[name] = instance <span class="comment">// 将变化的instance 添加到to.instances 对象里面</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">from</span> &amp;&amp; <span class="keyword">from</span> !== to &amp;&amp; instance &amp;&amp; instance === oldInstance) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!to.leaveGuards.size) &#123; <span class="comment">// 如果 新跳转到的 路由 的 leaveGuards(离开守卫) 为0 我们则需要把 之前from 的 离开守卫 赋值给 to</span></span><br><span class="line">              to.leaveGuards = <span class="keyword">from</span>.leaveGuards</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!to.updateGuards.size) &#123; <span class="comment">// 如果 新跳转到的 路由 的 updateGuards(更新守卫) 为0 我们则需要把 之前from 的 更新守卫 赋值给 to</span></span><br><span class="line">              to.updateGuards = <span class="keyword">from</span>.updateGuards</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 触发 beforeRouteEnter 钩子</span></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          instance &amp;&amp;</span><br><span class="line">          to &amp;&amp;</span><br><span class="line">          (!<span class="keyword">from</span> || !isSameRouteRecord(to, <span class="keyword">from</span>) || !oldInstance)</span><br><span class="line">        ) &#123;</span><br><span class="line">          ;(to.enterCallbacks[name] || []).forEach(<span class="function"><span class="params">callback</span> =&gt;</span></span><br><span class="line">            callback(instance)</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; flush: <span class="string">'post'</span> &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> route = routeToDisplay.value</span><br><span class="line">      <span class="keyword">const</span> matchedRoute = matchedRouteRef.value</span><br><span class="line">      <span class="keyword">const</span> ViewComponent = matchedRoute &amp;&amp; matchedRoute.components[props.name]</span><br><span class="line">      <span class="keyword">const</span> currentName = props.name</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 不存在 组件时 展示插槽</span></span><br><span class="line">      <span class="keyword">if</span> (!ViewComponent) &#123;</span><br><span class="line">        <span class="keyword">return</span> normalizeSlot(slots.default, &#123; Component: ViewComponent, route &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> routePropsOption = matchedRoute!.props[props.name]</span><br><span class="line">      <span class="keyword">const</span> routeProps = routePropsOption</span><br><span class="line">        ? routePropsOption === <span class="literal">true</span></span><br><span class="line">          ? route.params</span><br><span class="line">          : <span class="keyword">typeof</span> routePropsOption === <span class="string">'function'</span></span><br><span class="line">          ? routePropsOption(route)</span><br><span class="line">          : routePropsOption</span><br><span class="line">        : <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 卸载</span></span><br><span class="line">      <span class="keyword">const</span> onVnodeUnmounted: VNodeProps[<span class="string">'onVnodeUnmounted'</span>] = <span class="function"><span class="params">vnode</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// remove the instance reference to prevent leak</span></span><br><span class="line">        <span class="keyword">if</span> (vnode.component!.isUnmounted) &#123;</span><br><span class="line">          matchedRoute!.instances[currentName] = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 生成一个 component</span></span><br><span class="line">      <span class="keyword">const</span> component = h(</span><br><span class="line">        ViewComponent,</span><br><span class="line">        assign(&#123;&#125;, routeProps, attrs, &#123;</span><br><span class="line">          onVnodeUnmounted,</span><br><span class="line">          ref: viewRef,</span><br><span class="line">        &#125;)</span><br><span class="line">      )</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        normalizeSlot(slots.default, &#123; Component: component, route &#125;) ||</span><br><span class="line">        component</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正常话 slot</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">normalizeSlot</span>(<span class="params">slot: Slot | <span class="literal">undefined</span>, data: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!slot) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  <span class="keyword">const</span> slotContent = slot(data)</span><br><span class="line">  <span class="keyword">return</span> slotContent.length === <span class="number">1</span> ? slotContent[<span class="number">0</span>] : slotContent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出的RouterView </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RouterView = (RouterViewImpl <span class="keyword">as</span> <span class="built_in">any</span>) <span class="keyword">as</span> &#123;</span><br><span class="line">  <span class="keyword">new</span> (): &#123;</span><br><span class="line">    $props: AllowedComponentProps &amp;</span><br><span class="line">      ComponentCustomProps &amp;</span><br><span class="line">      VNodeProps &amp;</span><br><span class="line">      RouterViewProps</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">warnDeprecatedUsage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> instance = getCurrentInstance()!</span><br><span class="line">  <span class="keyword">const</span> parentName = instance.parent &amp;&amp; instance.parent.type.name</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    parentName &amp;&amp;</span><br><span class="line">    (parentName === <span class="string">'KeepAlive'</span> || parentName.includes(<span class="string">'Transition'</span>))</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">const</span> comp = parentName === <span class="string">'KeepAlive'</span> ? <span class="string">'keep-alive'</span> : <span class="string">'transition'</span></span><br><span class="line">    warn(</span><br><span class="line">      <span class="string">`&lt;router-view&gt; can no longer be used directly inside &lt;transition&gt; or &lt;keep-alive&gt;.\n`</span> +</span><br><span class="line">        <span class="string">`Use slot props instead:\n\n`</span> +</span><br><span class="line">        <span class="string">`&lt;router-view v-slot="&#123; Component &#125;"&gt;\n`</span> +</span><br><span class="line">        <span class="string">`  &lt;<span class="subst">$&#123;comp&#125;</span>&gt;\n`</span> +</span><br><span class="line">        <span class="string">`    &lt;component :is="Component" /&gt;\n`</span> +</span><br><span class="line">        <span class="string">`  &lt;/<span class="subst">$&#123;comp&#125;</span>&gt;\n`</span> +</span><br><span class="line">        <span class="string">`&lt;/router-view&gt;`</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="createRouter"><a href="#createRouter" class="headerlink" title="createRouter"></a>createRouter</h3><p>创建一个可以被 Vue 应用程序使用的路由实例</p>
<p>函数签名</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">declare</span> <span class="function"><span class="keyword">function</span> <span class="title">createRouter</span>(<span class="params">options: RouterOptions</span>): <span class="title">Router</span></span></span><br></pre></td></tr></table></figure>

<p>参数: </p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">options</td>
<td align="center">RouterOptions</td>
<td align="center">Options 用来初始化 router</td>
</tr>
</tbody></table>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> _PathParserOptions &#123;</span><br><span class="line">  sensitive?: <span class="built_in">boolean</span> <span class="comment">// RegExp区分大小写 默认 false</span></span><br><span class="line">  strict?: <span class="built_in">boolean</span> <span class="comment">// 是否应该禁止在斜线后面加上斜线 默认 false</span></span><br><span class="line">  start?: <span class="built_in">boolean</span> <span class="comment">// RegExp是否应该通过在开头添加一个^来匹配 默认 true</span></span><br><span class="line">  end?: <span class="built_in">boolean</span> <span class="comment">// RegExp是否应该通过在末尾附加一个$来匹配 默认 true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pick 挑选 从 _PathParserOptions 挑选出 'end' 'sensitive' 'strict' 重新组成一个类型 PathParserOptions</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> PathParserOptions = Pick&lt;</span><br><span class="line">  _PathParserOptions,</span><br><span class="line">  <span class="string">'end'</span> | <span class="string">'sensitive'</span> | <span class="string">'strict'</span></span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HistoryLocation = <span class="built_in">string</span> <span class="comment">// string的别名</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">type</span> HistoryStateValue =</span><br><span class="line">  | <span class="built_in">string</span></span><br><span class="line">  | <span class="built_in">number</span></span><br><span class="line">  | <span class="built_in">boolean</span></span><br><span class="line">  | <span class="literal">null</span></span><br><span class="line">  | <span class="literal">undefined</span></span><br><span class="line">  | HistoryState</span><br><span class="line">  | HistoryStateArray</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> HistoryState &#123;</span><br><span class="line">  [x: <span class="built_in">number</span>]: HistoryStateValue</span><br><span class="line">  [x: <span class="built_in">string</span>]: HistoryStateValue</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> RouterHistory &#123;</span><br><span class="line">  readonly base: <span class="built_in">string</span> <span class="comment">// 基础路径</span></span><br><span class="line">  readonly location: HistoryLocation <span class="comment">// 当前的记录位置</span></span><br><span class="line">  readonly state: HistoryState <span class="comment">// 当前记录的状态</span></span><br><span class="line">  <span class="comment">// readonly location: ValueContainer&lt;HistoryLocationNormalized&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// push 方法 跳转到相应的路由</span></span><br><span class="line">  push(to: HistoryLocation, data?: HistoryState): <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// replace 方法 也有跳转 但是 不会进入记录里面 </span></span><br><span class="line">  replace(to: HistoryLocation, data?: HistoryState): <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 前进 第二个参数为是否添加到监听历史里面</span></span><br><span class="line">  go(delta: <span class="built_in">number</span>, triggerListeners?: <span class="built_in">boolean</span>): <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 监听 返回值是一个销毁listen 的函数</span></span><br><span class="line">  listen(callback: NavigationCallback): <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 创建一个 href</span></span><br><span class="line">  createHref(location: HistoryLocation): <span class="built_in">string</span></span><br><span class="line">  <span class="comment">// 清除所有的事件</span></span><br><span class="line">  destroy(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> RouterScrollBehavior &#123;</span><br><span class="line">  (</span><br><span class="line">    to: RouteLocationNormalized, <span class="comment">// 到哪个页面</span></span><br><span class="line">    <span class="keyword">from</span>: RouteLocationNormalizedLoaded, <span class="comment">// 从哪个页面去</span></span><br><span class="line">    savedPosition: _ScrollPositionNormalized | <span class="literal">null</span> <span class="comment">// 存放 top, left , behavior 的对象</span></span><br><span class="line">  ): Awaitable&lt;ScrollPosition | <span class="literal">false</span> | <span class="built_in">void</span>&gt; <span class="comment">// 返回值是一个 promise</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> ScrollPositionCoordinates = &#123;</span><br><span class="line">  behavior?: ScrollOptions[<span class="string">'behavior'</span>] <span class="comment">// "auto" | "smooth"</span></span><br><span class="line">  left?: <span class="built_in">number</span> <span class="comment">// 距左边距离</span></span><br><span class="line">  top?: <span class="built_in">number</span> <span class="comment">// 距顶部记录</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// RouterOptions </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> RouterOptions <span class="keyword">extends</span> PathParserOptions &#123;</span><br><span class="line">  history: RouterHistory <span class="comment">// 路由器的使用历史记录</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">		createMemoryHistory:  创建基于内存的历史记录 通常用于SSR</span></span><br><span class="line"><span class="comment">		createWebHashHistory: 创建 hash 路由  可用于没有主机的 web	应用程序</span></span><br><span class="line"><span class="comment">		createWebHistory: 创建 HTML5 历史记录 , 通常用于SPA	</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">  routes: RouteRecordRaw[] <span class="comment">// 用户的路由</span></span><br><span class="line">  scrollBehavior?: RouterScrollBehavior <span class="comment">// from 到 to 页面跳转时可以控制其 页面滑动到多少多少位置 类似锚点 返回值一个promise </span></span><br><span class="line">  parseQuery?: <span class="keyword">typeof</span> originalParseQuery <span class="comment">// 自定义解析查询</span></span><br><span class="line">  stringifyQuery?: <span class="keyword">typeof</span> originalStringifyQuery <span class="comment">// 自定义实现以对查询对象进行字符串化</span></span><br><span class="line">  linkActiveClass?: <span class="built_in">string</span> <span class="comment">// router-link h函数那里会使用这个 router-link props 和 这里没有定义 默认就是 router-link-active</span></span><br><span class="line">  linkExactActiveClass?: <span class="built_in">string</span> <span class="comment">// router-link h函数那里会使用这个 router-link props 和 这里没有定义 默认就是 router-link-exact-active</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'qs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  createRouter,</span><br><span class="line">  createWebHistory,</span><br><span class="line">  parseQuery,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'vue-router'</span>;</span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  history: createWebHistory(process.env.BASE_URL),</span><br><span class="line">  routes,</span><br><span class="line">  scrollBehavior(to, <span class="keyword">from</span>, savePosition) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      top: <span class="number">100</span>,</span><br><span class="line">      left: <span class="number">100</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  parseQuery, <span class="comment">// 官方源码位置给的 qs.parse 但是在ts 中会报类型不能兼容的错误, 这里的 parseQuery 是官方自己写好的 从 vue-router导出来就好了</span></span><br><span class="line">  stringifyQuery: qs.stringify,</span><br><span class="line">  linkActiveClass: <span class="string">'activeClass'</span>,</span><br><span class="line">  linkExactActiveClass: <span class="string">'exactActiveClass'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 哈希 的历史记录</span></span><br><span class="line"><span class="keyword">const</span> hashRouter = createRouter(&#123;</span><br><span class="line">  history: createWebHashHistory(), <span class="comment">// 没有 base，应用托管在域名 `https://example.com` 的根目录下 有就在 https://example.com/base/</span></span><br><span class="line">  routes,</span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 内存 的历史记录</span></span><br><span class="line"><span class="keyword">const</span> memoryRouter = createMemoryHistory();</span><br><span class="line"></span><br><span class="line"><span class="comment">// at https://example.com/folder</span></span><br><span class="line">createWebHashHistory() <span class="comment">// 给出的网址为 `https://example.com/folder#`</span></span><br><span class="line">createWebHashHistory(<span class="string">'/folder/'</span>) <span class="comment">// 给出的网址为 `https://example.com/folder/#`</span></span><br><span class="line"><span class="comment">// 如果在 base 中提供了 `#`，则它不会被 `createWebHashHistory` 添加</span></span><br><span class="line">createWebHashHistory(<span class="string">'/folder/#/app/'</span>) <span class="comment">// 给出的网址为 `https://example.com/folder/#/app/`</span></span><br><span class="line"><span class="comment">// 你应该避免这样做，因为它会更改原始 url 并打断正在复制的 url</span></span><br><span class="line">createWebHashHistory(<span class="string">'/other-folder/'</span>) <span class="comment">// 给出的网址为 `https://example.com/other-folder/#`</span></span><br><span class="line"><span class="comment">// at file:///usr/etc/folder/index.html</span></span><br><span class="line"><span class="comment">// 对于没有 `host` 的位置，base被忽略</span></span><br><span class="line">createWebHashHistory(<span class="string">'/iAmIgnored'</span>) <span class="comment">// 给出的网址为 `file:///usr/etc/folder/index.html#`</span></span><br></pre></td></tr></table></figure>

<h4 id="createRouter-源码"><a href="#createRouter-源码" class="headerlink" title="createRouter 源码"></a>createRouter 源码</h4><p><code>src/router.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Router </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Router &#123;</span><br><span class="line">  <span class="comment">// 当前 route</span></span><br><span class="line">  readonly currentRoute: Ref&lt;RouteLocationNormalizedLoaded&gt;</span><br><span class="line">  <span class="comment">// createRouter 传入的那个options</span></span><br><span class="line">  readonly options: RouterOptions</span><br><span class="line">  <span class="comment">// 添加一个子路由 </span></span><br><span class="line">  addRoute(parentName: RouteRecordName, route: RouteRecordRaw): <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 添加路由</span></span><br><span class="line">  addRoute(route: RouteRecordRaw): <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 通过路由名称删除路由</span></span><br><span class="line">  removeRoute(name: RouteRecordName): <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 根据name 判断是否存在</span></span><br><span class="line">  hasRoute(name: RouteRecordName): <span class="built_in">boolean</span></span><br><span class="line">  <span class="comment">// 获取路由表</span></span><br><span class="line">  getRoutes(): RouteRecord[]</span><br><span class="line">	<span class="comment">// 就是将 "/home" &#123; path: "/home" &#125; 这样的跳转 转换成 RouteLocation &amp; &#123; href: string &#125; 的一个对象</span></span><br><span class="line">  resolve(</span><br><span class="line">    to: RouteLocationRaw,</span><br><span class="line">    currentLocation?: RouteLocationNormalizedLoaded</span><br><span class="line">  ): RouteLocation &amp; &#123; href: <span class="built_in">string</span> &#125;</span><br><span class="line">	<span class="comment">// 跳转的新的导航 push 进 历史堆</span></span><br><span class="line">  push(to: RouteLocationRaw): <span class="built_in">Promise</span>&lt;NavigationFailure | <span class="built_in">void</span> | <span class="literal">undefined</span>&gt;</span><br><span class="line">	<span class="comment">// 跳转的新的导航 替换 之前的导航 </span></span><br><span class="line">  replace(to: RouteLocationRaw): <span class="built_in">Promise</span>&lt;NavigationFailure | <span class="built_in">void</span> | <span class="literal">undefined</span>&gt;</span><br><span class="line">	<span class="comment">// 历史回退 router.go(-1)</span></span><br><span class="line">  back(): ReturnType&lt;Router[<span class="string">'go'</span>]&gt;</span><br><span class="line">	<span class="comment">// 历史前进 router.go(1)</span></span><br><span class="line">  forward(): ReturnType&lt;Router[<span class="string">'go'</span>]&gt;</span><br><span class="line">	<span class="comment">// 跳转</span></span><br><span class="line">  go(delta: <span class="built_in">number</span>): <span class="built_in">void</span></span><br><span class="line">	<span class="comment">// 进入路由之前的导航钩子 返回值是 删除这个导航钩子的</span></span><br><span class="line">  beforeEach(guard: NavigationGuardWithThis&lt;<span class="literal">undefined</span>&gt;): <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">	<span class="comment">// resolve 之前 返回值是 删除这个钩子的方法</span></span><br><span class="line">  beforeResolve(guard: NavigationGuardWithThis&lt;<span class="literal">undefined</span>&gt;): <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">	<span class="comment">// 进入导航后 执行的钩子 返回值 是删除这个钩子的方法</span></span><br><span class="line">  afterEach(guard: NavigationHookAfter): <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 导航中 发生错误时 触发的钩子	</span></span><br><span class="line">  onError(handler: _ErrorHandler): <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 路由的相关配置都已经完成了</span></span><br><span class="line">  isReady(): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt;</span><br><span class="line">  <span class="comment">// 注册 router 的方法</span></span><br><span class="line">  install(app: App): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 router</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createRouter</span>(<span class="params">options: RouterOptions</span>): <span class="title">Router</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> matcher = createRouterMatcher(options.routes, options) <span class="comment">// 创建一个匹配器</span></span><br><span class="line">  <span class="keyword">let</span> parseQuery = options.parseQuery || originalParseQuery <span class="comment">// 如果用户定义了 parseQuery 用 用户的 否则用自带的</span></span><br><span class="line">  <span class="keyword">let</span> stringifyQuery = options.stringifyQuery || originalStringifyQuery <span class="comment">// 如果用户定义了 stringifyQuery 用 用户的 否则用自带的</span></span><br><span class="line">  <span class="keyword">let</span> routerHistory = options.history <span class="comment">// 取出history</span></span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !routerHistory) <span class="comment">// 开发环境下且 用户没有定义 history</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">'Provide the "history" option when calling "createRouter()":'</span> +</span><br><span class="line">        <span class="string">' https://next.router.vuejs.org/api/#history.'</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">  <span class="comment">// useCallbacks =&gt; 返回的一个对象&#123;add, list, reset&#125;  add 方法 添加handler进handlers 数组, list 返回handlers, reset将handles 重置为空</span></span><br><span class="line">  <span class="keyword">const</span> beforeGuards = useCallbacks&lt;NavigationGuardWithThis&lt;<span class="literal">undefined</span>&gt;&gt;() <span class="comment">// 创建 beforeEach callbacks</span></span><br><span class="line">  <span class="keyword">const</span> beforeResolveGuards = useCallbacks&lt;NavigationGuardWithThis&lt;<span class="literal">undefined</span>&gt;&gt;() <span class="comment">// 创建 beforeResolveEach callbacks</span></span><br><span class="line">  <span class="keyword">const</span> afterGuards = useCallbacks&lt;NavigationHookAfter&gt;() <span class="comment">// 创建 afterEach callbacks</span></span><br><span class="line">  <span class="keyword">const</span> currentRoute = shallowRef&lt;RouteLocationNormalizedLoaded&gt;(</span><br><span class="line">    START_LOCATION_NORMALIZED</span><br><span class="line">  ) <span class="comment">// 初始化 currentRoute</span></span><br><span class="line">  <span class="keyword">let</span> pendingLocation: RouteLocation = START_LOCATION_NORMALIZED <span class="comment">// 初始化 待办的 location</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 浏览器环境,  options 里提供了 scrollBehavior , 'scrollRestoration' 在history 中</span></span><br><span class="line">  <span class="keyword">if</span> (isBrowser &amp;&amp; options.scrollBehavior &amp;&amp; <span class="string">'scrollRestoration'</span> <span class="keyword">in</span> history) &#123;</span><br><span class="line">    history.scrollRestoration = <span class="string">'manual'</span> <span class="comment">// 防止自动恢复页面 'auto' 表示 恢复到用户已滚动到的位置</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// applyToParams =&gt; 传入一个方法 然后 params的每个键值作为参数调用这个方法</span></span><br><span class="line">  <span class="keyword">const</span> normalizeParams = applyToParams.bind(</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    paramValue =&gt; <span class="string">''</span> + paramValue</span><br><span class="line">  ) <span class="comment">// params 的每个键值 都会调用 paramValue =&gt; '' + paramValue 方法</span></span><br><span class="line">  <span class="keyword">const</span> encodeParams = applyToParams.bind(<span class="literal">null</span>, encodeParam) <span class="comment">// params 的每个键值 都会调用 encodeParam 方法</span></span><br><span class="line">  <span class="keyword">const</span> decodeParams = applyToParams.bind(<span class="literal">null</span>, decode)  <span class="comment">// params 的每个键值 都会调用 decode 方法</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下面的方法 具体实现我后面 再去研究 </span></span><br><span class="line">  <span class="comment">// router 的 addRoute 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addRoute</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    parentOrRoute: RouteRecordName | RouteRecordRaw,</span></span></span><br><span class="line"><span class="function"><span class="params">    route?: RouteRecordRaw</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// router 的 removeRoute 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">removeRoute</span>(<span class="params">name: RouteRecordName</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// router 的 getRoutes 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// router 的 hasRoute 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">hasRoute</span>(<span class="params">name: RouteRecordName</span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">     <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// router 的resolve 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    rawLocation: Readonly&lt;RouteLocationRaw&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">    currentLocation?: RouteLocationNormalizedLoaded</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">RouteLocation</span> &amp; </span>&#123; href: <span class="built_in">string</span> &#125; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 辅助方法 将 路由地址 转换成对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">locationAsObject</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    to: RouteLocationRaw | RouteLocationNormalized</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">Exclude</span>&lt;<span class="title">RouteLocationRaw</span>, <span class="title">string</span>&gt; | <span class="title">RouteLocationNormalized</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 验证已经取消的 导航</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">checkCanceledNavigation</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    to: RouteLocationNormalized,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">from</span>: RouteLocationNormalized</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">NavigationFailure</span> | <span class="title">void</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">  <span class="comment">// router 的 push 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">push</span>(<span class="params">to: RouteLocationRaw | RouteLocation</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// router 的 replace 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">replace</span>(<span class="params">to: RouteLocationRaw | RouteLocationNormalized</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 处理重定向记录的方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleRedirectRecord</span>(<span class="params">to: RouteLocation</span>): <span class="title">RouteLocationRaw</span> | <span class="title">void</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重定向的添加进 记录</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">pushWithRedirect</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    to: RouteLocationRaw | RouteLocation,</span></span></span><br><span class="line"><span class="function"><span class="params">    redirectedFrom?: RouteLocation</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">Promise</span>&lt;<span class="title">NavigationFailure</span> | <span class="title">void</span> | <span class="title">undefined</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 验证 取消的导航 和 拒绝的导航</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">checkCanceledNavigationAndReject</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    to: RouteLocationNormalized,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">from</span>: RouteLocationNormalized</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">Promise</span>&lt;<span class="title">void</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// router 的 navigate 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">navigate</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    to: RouteLocationNormalized,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">from</span>: RouteLocationNormalizedLoaded</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">Promise</span>&lt;<span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 触发 afterEach 这个钩子的方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">triggerAfterEach</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    to: RouteLocationNormalizedLoaded,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">from</span>: RouteLocationNormalizedLoaded,</span></span></span><br><span class="line"><span class="function"><span class="params">    failure?: NavigationFailure | <span class="built_in">void</span></span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 导航完成之后 调用的方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">finalizeNavigation</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    toLocation: RouteLocationNormalizedLoaded,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">from</span>: RouteLocationNormalizedLoaded,</span></span></span><br><span class="line"><span class="function"><span class="params">    isPush: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    replace?: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    data?: HistoryState</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">NavigationFailure</span> | <span class="title">void</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 移出 历史记录 侦听的方法</span></span><br><span class="line">  <span class="keyword">let</span> removeHistoryListener: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 侦听 历史记录 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setupListeners</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化 ready 和 error 的handlers</span></span><br><span class="line">  <span class="keyword">let</span> readyHandlers = useCallbacks&lt;OnReadyCallback&gt;()</span><br><span class="line">  <span class="keyword">let</span> errorHandlers = useCallbacks&lt;_ErrorHandler&gt;()</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// router 初始化是否完成的 标志</span></span><br><span class="line">  <span class="keyword">let</span> ready: <span class="built_in">boolean</span> </span><br><span class="line"></span><br><span class="line">	<span class="comment">// 触发 errorHandler 的方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">triggerError</span>(<span class="params">error: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// router 的isReady 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isReady</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">void</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将 router 的标记为 ready  这个方法 只会被调用一次</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">markAsReady</span>(<span class="params">err?: <span class="built_in">any</span></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Scroll behavior</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleScroll</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    to: RouteLocationNormalizedLoaded,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">from</span>: RouteLocationNormalizedLoaded,</span></span></span><br><span class="line"><span class="function"><span class="params">    isPush: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    isFirstNavigation: <span class="built_in">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">Promise</span>&lt;<span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// router 的 go 方法</span></span><br><span class="line">  <span class="keyword">const</span> go = <span class="function">(<span class="params">delta: <span class="built_in">number</span></span>) =&gt;</span> routerHistory.go(delta)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始标记</span></span><br><span class="line">  <span class="keyword">let</span> started: <span class="built_in">boolean</span> | <span class="literal">undefined</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 当前 router 注册的 app 的 Set 集合</span></span><br><span class="line">  <span class="keyword">const</span> installedApps = <span class="keyword">new</span> Set&lt;App&gt;()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化 router</span></span><br><span class="line">  <span class="keyword">const</span> router: Router = &#123;</span><br><span class="line">    currentRoute,</span><br><span class="line"></span><br><span class="line">    addRoute,</span><br><span class="line">    removeRoute,</span><br><span class="line">    hasRoute,</span><br><span class="line">    getRoutes,</span><br><span class="line">    resolve,</span><br><span class="line">    options,</span><br><span class="line"></span><br><span class="line">    push,</span><br><span class="line">    replace,</span><br><span class="line">    go,</span><br><span class="line">    back: <span class="function"><span class="params">()</span> =&gt;</span> go(<span class="number">-1</span>),</span><br><span class="line">    forward: <span class="function"><span class="params">()</span> =&gt;</span> go(<span class="number">1</span>),</span><br><span class="line"></span><br><span class="line">    beforeEach: beforeGuards.add,</span><br><span class="line">    beforeResolve: beforeResolveGuards.add,</span><br><span class="line">    afterEach: afterGuards.add,</span><br><span class="line"></span><br><span class="line">    onError: errorHandlers.add,</span><br><span class="line">    isReady,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 暴露的注册方法 </span></span><br><span class="line">    install(app: App) &#123;</span><br><span class="line">      <span class="keyword">const</span> router = <span class="keyword">this</span></span><br><span class="line">      app.component(<span class="string">'RouterLink'</span>, RouterLink) <span class="comment">// 注册 RouterLink 组件</span></span><br><span class="line">      app.component(<span class="string">'RouterView'</span>, RouterView) <span class="comment">// 注册 RouterView 组件</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 在 app 的全局属性上 挂载 $router</span></span><br><span class="line">      app.config.globalProperties.$router = router</span><br><span class="line">      <span class="comment">// 通过 defineProperty 设置 访问 ctx.config.globalProperties.$route 返回当前的 路由</span></span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(app.config.globalProperties, <span class="string">'$route'</span>, &#123;</span><br><span class="line">        <span class="keyword">get</span>: <span class="function"><span class="params">()</span> =&gt;</span> unref(currentRoute),</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 初始化 导航</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        isBrowser &amp;&amp; <span class="comment">// 是浏览器</span></span><br><span class="line">        !started &amp;&amp; <span class="comment">// started 的值是 Falsy</span></span><br><span class="line">        currentRoute.value === START_LOCATION_NORMALIZED <span class="comment">// 且 currentRoute.value 为 那个初始化的</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="comment">// 修改 started 为 true</span></span><br><span class="line">        started = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// routerHistory 就是 用户使用 createWebHistory 返回的值 </span></span><br><span class="line">        <span class="comment">// 然后跳转到 location 并这个 时候会catch error </span></span><br><span class="line">        push(routerHistory.location).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (__DEV__) warn(<span class="string">'Unexpected error when starting the router:'</span>, err)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 定义一个 响应式 route</span></span><br><span class="line">      <span class="keyword">const</span> reactiveRoute = &#123;&#125; <span class="keyword">as</span> &#123;</span><br><span class="line">        [k <span class="keyword">in</span> keyof RouteLocationNormalizedLoaded]: ComputedRef&lt;</span><br><span class="line">          RouteLocationNormalizedLoaded[k]</span><br><span class="line">        &gt;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 初始化 reactiveRoute</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> START_LOCATION_NORMALIZED) &#123;</span><br><span class="line">        <span class="comment">// @ts-ignore: the key matches</span></span><br><span class="line">        reactiveRoute[key] = computed(<span class="function"><span class="params">()</span> =&gt;</span> currentRoute.value[key])</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      app.provide(routerKey, router) <span class="comment">// 提供一个 router 所以 useRouter 其实就是返回的 inject(routerKey)</span></span><br><span class="line">      app.provide(routeLocationKey, reactive(reactiveRoute)) <span class="comment">// 提供一个 reactiveRoute</span></span><br><span class="line">      app.provide(routerViewLocationKey, currentRoute) <span class="comment">// 提供一个currentRoute 所以 useRoute 就是 返回的 inject(routeLocationKey)</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 取出 app.unmount 卸载方法</span></span><br><span class="line">      <span class="keyword">let</span> unmountApp = app.unmount</span><br><span class="line">      installedApps.add(app) <span class="comment">// 将当前的 app 添加进 app Set集合</span></span><br><span class="line">      <span class="comment">// 重写 app的 卸载方法</span></span><br><span class="line">      app.unmount = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        installedApps.delete(app) <span class="comment">// 在Set 集合中删除当前的 app</span></span><br><span class="line">        <span class="keyword">if</span> (installedApps.size &lt; <span class="number">1</span>) &#123; <span class="comment">// 判断 当前的 Set 集合 已经没有 别的app</span></span><br><span class="line">          removeHistoryListener() <span class="comment">// 调用 删除 历史 的侦听</span></span><br><span class="line">          currentRoute.value = START_LOCATION_NORMALIZED <span class="comment">// 当前路由的 值 重置为 START_LOCATION_NORMALIZED</span></span><br><span class="line">          started = <span class="literal">false</span> <span class="comment">// 重置 started</span></span><br><span class="line">          ready = <span class="literal">false</span> <span class="comment">// 重置 ready 状态</span></span><br><span class="line">        &#125;</span><br><span class="line">        unmountApp() <span class="comment">// 调用原本的卸载方法</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 支持 这个feature 就将router 添加进 devtool</span></span><br><span class="line">      <span class="keyword">if</span> ((__DEV__ || __FEATURE_PROD_DEVTOOLS__) &amp;&amp; __BROWSER__) &#123;</span><br><span class="line">        addDevtools(app, router, matcher)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> router</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useCallbacks"><a href="#useCallbacks" class="headerlink" title="useCallbacks"></a>useCallbacks</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useCallbacks</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> handlers: T[] = []</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">handler: T</span>): (<span class="params"></span>) =&gt; <span class="title">void</span> </span>&#123;</span><br><span class="line">    handlers.push(handler)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> i = handlers.indexOf(handler)</span><br><span class="line">      <span class="keyword">if</span> (i &gt; <span class="number">-1</span>) handlers.splice(i, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    handlers = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    add,</span><br><span class="line">    list: <span class="function"><span class="params">()</span> =&gt;</span> handlers,</span><br><span class="line">    reset,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="applyToParams"><a href="#applyToParams" class="headerlink" title="applyToParams"></a>applyToParams</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">applyToParams</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  fn: (v: <span class="built_in">string</span> | <span class="built_in">number</span>) =&gt; <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  params: RouteParamsRaw | <span class="literal">undefined</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">RouteParams</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newParams: RouteParams = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = params[key]</span><br><span class="line">    newParams[key] = <span class="built_in">Array</span>.isArray(value) ? value.map(fn) : fn(value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newParams</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="NavigationFailureType"><a href="#NavigationFailureType" class="headerlink" title="NavigationFailureType"></a>NavigationFailureType</h3><p>包含所有可能导航失败类型的枚举, 可以传递给 <code>isNavigationFailure</code> 来检查某些特定类型的失败, <strong>不要使用任何数值</strong>, 总是使用诸如<code>NavigationFailureType.aborted</code> 这样的变量</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> NavigationFailureType &#123;</span><br><span class="line">  aborted = ErrorTypes.NAVIGATION_ABORTED, <span class="comment">// 4 终止导航是指由于导航守卫返回 false 或调用 next(false) 而失败的导航</span></span><br><span class="line">  cancelled = ErrorTypes.NAVIGATION_CANCELLED, <span class="comment">// 8 取消导航是指由于最近的导航完成启动（不一定是完成）而失败的导航</span></span><br><span class="line">  duplicated = ErrorTypes.NAVIGATION_DUPLICATED, <span class="comment">// 16 重复导航是指在启动时已经在同一位置失败的导航</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="keyword">enum</span> ErrorTypes &#123;</span><br><span class="line">  MATCHER_NOT_FOUND = <span class="number">1</span>, <span class="comment">// 没有找到</span></span><br><span class="line">  NAVIGATION_GUARD_REDIRECT = <span class="number">2</span>, <span class="comment">// 重定向</span></span><br><span class="line">  NAVIGATION_ABORTED = <span class="number">4</span>, <span class="comment">// 已中止</span></span><br><span class="line">  NAVIGATION_CANCELLED = <span class="number">8</span>, <span class="comment">// 已取消</span></span><br><span class="line">  NAVIGATION_DUPLICATED = <span class="number">16</span>, <span class="comment">// 重复</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 看看 isNavigationFailure 的实现</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isNavigationFailure</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  error: <span class="built_in">any</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">type</span>?: ErrorTypes.NAVIGATION_GUARD_REDIRECT <span class="comment">// 值是2  导航守卫 重定向 error</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">error</span> <span class="title">is</span> <span class="title">NavigationRedirectError</span></span></span><br><span class="line"><span class="function"><span class="title">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isNavigationFailure</span>(<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="params">  error: <span class="built_in">any</span>,</span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="params">  <span class="keyword">type</span>?: ErrorTypes | NavigationFailureType</span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="params"></span>): <span class="title">error</span> <span class="title">is</span> <span class="title">NavigationFailure</span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="title">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isNavigationFailure</span>(<span class="params"></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="params">  error: <span class="built_in">any</span>,</span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="params">  <span class="keyword">type</span>?: <span class="built_in">number</span></span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"><span class="params"></span>): <span class="title">error</span> <span class="title">is</span> <span class="title">NavigationFailure</span> </span>&#123;</span></span></span><br><span class="line"><span class="function"><span class="function">  <span class="title">return</span> (<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="params">    error <span class="keyword">instanceof</span> <span class="built_in">Error</span> &amp;&amp;</span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="params">    NavigationFailureSymbol <span class="keyword">in</span> error &amp;&amp;</span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="params">    (<span class="keyword">type</span> == <span class="literal">null</span> || !!((error <span class="keyword">as</span> NavigationFailure).<span class="keyword">type</span> &amp; <span class="keyword">type</span>))</span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="params">  </span>)</span></span></span><br><span class="line"><span class="function"><span class="function">&#125;</span></span></span><br><span class="line"><span class="function"><span class="function"></span></span></span><br><span class="line"><span class="function"><span class="function">// 例子 在 <span class="title">router</span> 的添加导航钩子中使用 </span></span></span><br><span class="line"><span class="function"><span class="function"><span class="title">import</span> </span>&#123;</span></span><br><span class="line"><span class="function">  <span class="title">isNavigationFailure</span>,</span></span><br><span class="line"><span class="function">  <span class="title">NavigationFailureType</span>,</span></span><br><span class="line"><span class="function">&#125; <span class="title">from</span> '<span class="title">vue</span>-<span class="title">router</span>'</span>;</span><br><span class="line">router.afterEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, failure</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (isNavigationFailure(failure)) &#123;</span><br><span class="line">    <span class="comment">// 是 ErrorTypes | NavigationFailureType 中的</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isNavigationFailure(failure, NavigationFailureType.duplicated)) &#123;</span><br><span class="line">    <span class="comment">// 是 重复导航 这个错误</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    isNavigationFailure(</span><br><span class="line">      failure,</span><br><span class="line">      NavigationFailureType.aborted | NavigationFailureType.cancelled,</span><br><span class="line">    )</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="comment">// 是 已中止 或者 已取消 这样的错误</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="START-LOCATION"><a href="#START-LOCATION" class="headerlink" title="START_LOCATION"></a>START_LOCATION</h4><p>路由所在的初始路由地址, 可用于导航守卫中, 以区分初始导航</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> START_LOCATION_NORMALIZED: RouteLocationNormalizedLoaded = &#123;</span><br><span class="line">  path: <span class="string">'/'</span>,</span><br><span class="line">  name: <span class="literal">undefined</span>,</span><br><span class="line">  params: &#123;&#125;,</span><br><span class="line">  query: &#123;&#125;,</span><br><span class="line">  hash: <span class="string">''</span>,</span><br><span class="line">  fullPath: <span class="string">'/'</span>,</span><br><span class="line">  matched: [],</span><br><span class="line">  meta: &#123;&#125;,</span><br><span class="line">  redirectedFrom: <span class="literal">undefined</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子 </span></span><br><span class="line"><span class="keyword">import</span> &#123; START_LOCATION &#125; <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(router.currentRoute.value === START_LOCATION); <span class="comment">// true  </span></span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">from</span> === START_LOCATION) &#123;</span><br><span class="line">    <span class="comment">// 初始导航</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="CompositionApi"><a href="#CompositionApi" class="headerlink" title="CompositionApi"></a>CompositionApi</h3><h4 id="onBeforeRouteLeave"><a href="#onBeforeRouteLeave" class="headerlink" title="onBeforeRouteLeave"></a>onBeforeRouteLeave</h4><p>添加一个导航守卫, 在当前位置的组件将要离开时触发, 类似于 <code>beforeRouteLeave</code>, 但它可以在任何组件中使用, 当组件被卸载时, 导航守卫将被移除</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">onBeforeRouteLeave</span>(<span class="params">leaveGuard: NavigationGuard</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !getCurrentInstance()) &#123;</span><br><span class="line">    warn(</span><br><span class="line">      <span class="string">'getCurrentInstance() returned null. onBeforeRouteLeave() must be called at the top of a setup function'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 当前点击的 记录</span></span><br><span class="line">  <span class="keyword">const</span> activeRecord: RouteRecordNormalized | <span class="literal">undefined</span> = inject(</span><br><span class="line">    matchedRouteKey,</span><br><span class="line">    &#123;&#125; <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">  ).value</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不存在 警告一下</span></span><br><span class="line">  <span class="keyword">if</span> (!activeRecord) &#123;</span><br><span class="line">    __DEV__ &amp;&amp;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">'No active route record was found. Are you missing a &lt;router-view&gt; component?'</span></span><br><span class="line">      )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 调用这个 注册守卫的方法</span></span><br><span class="line">  registerGuard(activeRecord, <span class="string">'leaveGuards'</span>, leaveGuard)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="onBeforeRouteUpdate"><a href="#onBeforeRouteUpdate" class="headerlink" title="onBeforeRouteUpdate"></a>onBeforeRouteUpdate</h4><p>添加一个导航守卫, 在当前位置即将更新时触发, 类似于 <code>beforeRouteUpdate</code>, 但它可以在任何组件中使用, 当组件被卸载时, 导航守卫将被移除</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">onBeforeRouteUpdate</span>(<span class="params">updateGuard: NavigationGuard</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !getCurrentInstance()) &#123;</span><br><span class="line">    warn(</span><br><span class="line">      <span class="string">'getCurrentInstance() returned null. onBeforeRouteUpdate() must be called at the top of a setup function'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">	<span class="comment">// 当前点击的 记录</span></span><br><span class="line">  <span class="keyword">const</span> activeRecord: RouteRecordNormalized | <span class="literal">undefined</span> = inject(</span><br><span class="line">    matchedRouteKey,</span><br><span class="line">    &#123;&#125; <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">  ).value</span><br><span class="line">	</span><br><span class="line">  <span class="comment">// 不存在 警告一下</span></span><br><span class="line">  <span class="keyword">if</span> (!activeRecord) &#123;</span><br><span class="line">    __DEV__ &amp;&amp;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">'No active route record was found. Are you missing a &lt;router-view&gt; component?'</span></span><br><span class="line">      )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">// 调用这个 注册守卫的方法</span></span><br><span class="line">  registerGuard(activeRecord, <span class="string">'updateGuards'</span>, updateGuard)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>registerGuard 方法</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">registerGuard</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  record: RouteRecordNormalized,</span></span></span><br><span class="line"><span class="function"><span class="params">  name: 'leaveGuards' | 'updateGuards',</span></span></span><br><span class="line"><span class="function"><span class="params">  guard: NavigationGuard</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 会把 记录中的 相应的钩子 Set集合 删除 当前执行的这个 guard钩子</span></span><br><span class="line">  <span class="keyword">const</span> removeFromList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    record[name].delete(guard)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在 卸载组件时  调用 removeFromList</span></span><br><span class="line">  onUnmounted(removeFromList)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 在 keepalive 组件没有激活的 时候 调用 removeFromList</span></span><br><span class="line">  onDeactivated(removeFromList)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在 keepalive 组件 激活时 添加进 集合</span></span><br><span class="line">  onActivated(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    record[name].add(guard)</span><br><span class="line">  &#125;)</span><br><span class="line">	</span><br><span class="line">  <span class="comment">// 注册时 就直接添加进 Set 集合</span></span><br><span class="line">  record[name].add(guard)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useLink"><a href="#useLink" class="headerlink" title="useLink"></a>useLink</h4><p>返回 <code>v-slot</code> API暴露的所有内容, 代码在 <code>router-link</code> 里面</p>
<h4 id="useRoute"><a href="#useRoute" class="headerlink" title="useRoute"></a>useRoute</h4><p>返回当前路由地址, 相当于在模板中使用 <code>$route</code>, 必须在 <code>setup()</code> 中调用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useRoute</span>(<span class="params"></span>): <span class="title">RouteLocationNormalizedLoaded</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> inject(routeLocationKey)!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="userRouter"><a href="#userRouter" class="headerlink" title="userRouter"></a>userRouter</h4><p>返回 <code>router</code> 实例, 相当于在模板中使用 <code>$router</code>, 必须在 <code>setup()</code> 中调用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useRouter</span>(<span class="params"></span>): <span class="title">Router</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> inject(routerKey)!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Router-方法"><a href="#Router-方法" class="headerlink" title="Router 方法"></a>Router 方法</h3><h4 id="addRoute"><a href="#addRoute" class="headerlink" title="addRoute"></a>addRoute</h4></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Decade W</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.decade.run/2021/05/09/Vue-Router-api/">http://blog.decade.run/2021/05/09/Vue-Router-api/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.decade.run" target="_blank">王小明</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/learn/">learn</a><a class="post-meta__tags" href="/tags/vueRouter/">vueRouter</a></div><div class="post_share"><div class="social-share" data-image="/img/coverimg/vue.jpg" data-sites="twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2021/04/28/vue3-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E4%B8%89/"><img class="next_cover lazyload" data-src="/img/coverimg/vue.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">vue3 源码阅读 watch</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/13/Hello-myBlog/" title="Hello myBlog"><img class="relatedPosts_cover lazyload"data-src="/img/hellomyblog/d2.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-13</div><div class="relatedPosts_title">Hello myBlog</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/19/data-structure/" title="数据结构与算法"><img class="relatedPosts_cover lazyload"data-src="/img/learn/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-19</div><div class="relatedPosts_title">数据结构与算法</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/19/ds2/" title="javascript执行上下文与执行栈"><img class="relatedPosts_cover lazyload"data-src="/img/learn/2.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-19</div><div class="relatedPosts_title">javascript执行上下文与执行栈</div></div></a></div><div class="relatedPosts_item"><a href="/2020/11/09/element-ui-3-源码学习-4/" title="element-ui-3-源码学习-4"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-11-09</div><div class="relatedPosts_title">element-ui-3-源码学习-4</div></div></a></div><div class="relatedPosts_item"><a href="/2020/11/05/element-ui-3-源码学习-3/" title="element-ui-3-源码学习-3"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-11-05</div><div class="relatedPosts_title">element-ui-3-源码学习-3</div></div></a></div><div class="relatedPosts_item"><a href="/2020/09/03/hook-in-vue3-0-2/" title="hook in vue3.0 - 2"><img class="relatedPosts_cover lazyload"data-src="/img/coverimg/vue.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-09-03</div><div class="relatedPosts_title">hook in vue3.0 - 2</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  appId: 'WzoNQ79zXHpLGhYhAiHrDU9m-gzGzoHsz',
  appKey: 'Nhmax4ME4ul4BPqWy3GGqIFq',
  placeholder: 'Please leave your footprints',
  avatar: '',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: true,
  serverURLs: '',
  mathjax: false
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Decade W</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi,  welcome  to  my  <a  href="http://blog.decade.run/">blog</a>!</div><div class="icp"><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>互联网ICP备案:渝ICP备19015868号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Search</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="canvas_nest" color="106,90,205" opacity="0.7" zIndex="-1" count="199" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/ClickShowText.js"></script><script src="/js/search/algolia.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script><div class="waifu"><div class="hide-button">隐藏</div><div class="waifu-tips"></div><canvas class="live2d" id="live2d" width="200" height="300"></canvas></div><script src="/lib/waifu-tips.js" async></script><script src="/lib/live2d.js"></script><script src="/lib/run.js"></script></body></html>