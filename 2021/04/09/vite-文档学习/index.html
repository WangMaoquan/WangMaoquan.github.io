<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>vite 文档学习 | 王小明</title><meta name="description" content="学习"><meta name="keywords" content="learn,vite"><meta name="author" content="Decade W"><meta name="copyright" content="Decade W"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><script src="https://code.jquery.com/jquery-3.4.1.min.js"></script><meta name="twitter:card" content="summary"><meta name="twitter:title" content="vite 文档学习"><meta name="twitter:description" content="学习"><meta name="twitter:image" content="http://blog.decade.run/img/coverimg/vue.jpg"><meta property="og:type" content="article"><meta property="og:title" content="vite 文档学习"><meta property="og:url" content="http://blog.decade.run/2021/04/09/vite-%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0/"><meta property="og:site_name" content="王小明"><meta property="og:description" content="学习"><meta property="og:image" content="http://blog.decade.run/img/coverimg/vue.jpg"><meta property="article:published_time" content="2021-04-09T03:03:10.000Z"><meta property="article:modified_time" content="2021-04-09T03:05:06.429Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://blog.decade.run/2021/04/09/vite-%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0/"><link rel="next" title="vue3 源码阅读(一)" href="http://blog.decade.run/2021/04/06/vue3-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E4%B8%80/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"LEP83554SS","apiKey":"96fa18c62f7619e2bf35df83ba4aef39","indexName":"...","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":0,"translateDelay":1,"cookieDomain":"https://blog.decade.run/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: Decade W","link":"链接: ","source":"来源: 王小明","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: {"text":"努力,学习","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="王小明" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">53</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">17</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item Home"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item Archives"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item Tag"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tag</span></a></div><div class="menus_item Categories"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item Link"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item About"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#vite创建项目"><span class="toc-number">1.</span> <span class="toc-text">vite创建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-number">2.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置文件解析"><span class="toc-number">2.1.</span> <span class="toc-text">配置文件解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置智能提示"><span class="toc-number">2.2.</span> <span class="toc-text">配置智能提示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#情景配置"><span class="toc-number">2.3.</span> <span class="toc-text">情景配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#异步配置"><span class="toc-number">2.4.</span> <span class="toc-text">异步配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#共享配置"><span class="toc-number">2.5.</span> <span class="toc-text">共享配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#root"><span class="toc-number">2.5.1.</span> <span class="toc-text">root</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#base"><span class="toc-number">2.5.2.</span> <span class="toc-text">base</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mode"><span class="toc-number">2.5.3.</span> <span class="toc-text">mode</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#define"><span class="toc-number">2.5.4.</span> <span class="toc-text">define</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#plugins"><span class="toc-number">2.5.5.</span> <span class="toc-text">plugins</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#publicDir"><span class="toc-number">2.5.6.</span> <span class="toc-text">publicDir</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#resolve-alias"><span class="toc-number">2.5.7.</span> <span class="toc-text">resolve.alias</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#resolve-dedupe"><span class="toc-number">2.5.8.</span> <span class="toc-text">resolve.dedupe</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#resolve-conditions"><span class="toc-number">2.5.9.</span> <span class="toc-text">resolve.conditions</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#resolve-extensions"><span class="toc-number">2.5.10.</span> <span class="toc-text">resolve.extensions</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#css-modules"><span class="toc-number">2.5.11.</span> <span class="toc-text">css.modules</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#css-postcss"><span class="toc-number">2.5.12.</span> <span class="toc-text">css.postcss</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#css-preprocessorOptions"><span class="toc-number">2.5.13.</span> <span class="toc-text">css.preprocessorOptions</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#json-namedExports"><span class="toc-number">2.5.14.</span> <span class="toc-text">json.namedExports</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#json-stringify"><span class="toc-number">2.5.15.</span> <span class="toc-text">json.stringify</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#esbuild"><span class="toc-number">2.5.16.</span> <span class="toc-text">esbuild</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#assetsInclude"><span class="toc-number">2.5.17.</span> <span class="toc-text">assetsInclude</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#logLevel"><span class="toc-number">2.5.18.</span> <span class="toc-text">logLevel</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#clearScreen"><span class="toc-number">2.5.19.</span> <span class="toc-text">clearScreen</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Server-Options"><span class="toc-number">2.6.</span> <span class="toc-text">Server Options</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#server-host"><span class="toc-number">2.6.1.</span> <span class="toc-text">server.host</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-port"><span class="toc-number">2.6.2.</span> <span class="toc-text">server.port</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-strictPort"><span class="toc-number">2.6.3.</span> <span class="toc-text">server.strictPort</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-https"><span class="toc-number">2.6.4.</span> <span class="toc-text">server.https</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-open"><span class="toc-number">2.6.5.</span> <span class="toc-text">server.open</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-proxy"><span class="toc-number">2.6.6.</span> <span class="toc-text">server.proxy</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-cors"><span class="toc-number">2.6.7.</span> <span class="toc-text">server.cors</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-force"><span class="toc-number">2.6.8.</span> <span class="toc-text">server.force</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-hmr"><span class="toc-number">2.6.9.</span> <span class="toc-text">server.hmr</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Build-Options"><span class="toc-number">2.7.</span> <span class="toc-text">Build Options</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#build-target"><span class="toc-number">2.7.1.</span> <span class="toc-text">build.target</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#build-polyfillDynamicImport"><span class="toc-number">2.7.2.</span> <span class="toc-text">build.polyfillDynamicImport</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#build-outDir"><span class="toc-number">2.7.3.</span> <span class="toc-text">build.outDir</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#build-assetsDir"><span class="toc-number">2.7.4.</span> <span class="toc-text">build.assetsDir</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#build-assetsInlineLimit"><span class="toc-number">2.7.5.</span> <span class="toc-text">build.assetsInlineLimit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#build-cssCodeSplit"><span class="toc-number">2.7.6.</span> <span class="toc-text">build.cssCodeSplit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#build-sourcemap"><span class="toc-number">2.7.7.</span> <span class="toc-text">build.sourcemap</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#依赖优化选项"><span class="toc-number">2.8.</span> <span class="toc-text">依赖优化选项</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#optimizeDeps-entries"><span class="toc-number">2.8.1.</span> <span class="toc-text">optimizeDeps.entries</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#optimizeDeps-exclude"><span class="toc-number">2.8.2.</span> <span class="toc-text">optimizeDeps.exclude</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#optimizeDeps-include"><span class="toc-number">2.8.3.</span> <span class="toc-text">optimizeDeps.include</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#optimizeDeps-keepNames"><span class="toc-number">2.8.4.</span> <span class="toc-text">optimizeDeps.keepNames</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSR-选项"><span class="toc-number">2.9.</span> <span class="toc-text">SSR 选项</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ssr-external"><span class="toc-number">2.9.1.</span> <span class="toc-text">ssr.external</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ssr-noExternal"><span class="toc-number">2.9.2.</span> <span class="toc-text">ssr.noExternal</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插件API"><span class="toc-number">3.</span> <span class="toc-text">插件API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#约定"><span class="toc-number">3.1.</span> <span class="toc-text">约定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#插件配置"><span class="toc-number">3.2.</span> <span class="toc-text">插件配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#简单示例"><span class="toc-number">3.3.</span> <span class="toc-text">简单示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通用的钩子"><span class="toc-number">3.4.</span> <span class="toc-text">通用的钩子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Vite-独有的钩子"><span class="toc-number">3.5.</span> <span class="toc-text">Vite 独有的钩子</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#config"><span class="toc-number">3.5.1.</span> <span class="toc-text">config</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#configResolved"><span class="toc-number">3.5.2.</span> <span class="toc-text">configResolved</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#configureServer"><span class="toc-number">3.5.3.</span> <span class="toc-text">configureServer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#transformIndexHtml"><span class="toc-number">3.5.4.</span> <span class="toc-text">transformIndexHtml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#handleHotUpdate"><span class="toc-number">3.5.5.</span> <span class="toc-text">handleHotUpdate</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#钩子的执行顺序"><span class="toc-number">3.5.6.</span> <span class="toc-text">钩子的执行顺序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#插件顺序"><span class="toc-number">3.6.</span> <span class="toc-text">插件顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#情景应用"><span class="toc-number">3.7.</span> <span class="toc-text">情景应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Rollup-插件兼容性"><span class="toc-number">3.8.</span> <span class="toc-text">Rollup 插件兼容性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#路径规范化"><span class="toc-number">3.9.</span> <span class="toc-text">路径规范化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HMR-API"><span class="toc-number">4.</span> <span class="toc-text">HMR API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#必需的条件守卫"><span class="toc-number">4.1.</span> <span class="toc-text">必需的条件守卫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hot-accept-cb"><span class="toc-number">4.2.</span> <span class="toc-text">hot.accept(cb)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hot-accept-deps-cb"><span class="toc-number">4.3.</span> <span class="toc-text">hot.accept(deps, cb)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hot-dispose-cb"><span class="toc-number">4.4.</span> <span class="toc-text">hot.dispose(cb)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hot-data"><span class="toc-number">4.5.</span> <span class="toc-text">hot.data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hot-decline"><span class="toc-number">4.6.</span> <span class="toc-text">hot.decline()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hot-invalidate"><span class="toc-number">4.7.</span> <span class="toc-text">hot.invalidate()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hot-on-event-cb"><span class="toc-number">4.8.</span> <span class="toc-text">hot.on(event, cb)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JavaScript-API"><span class="toc-number">5.</span> <span class="toc-text">JavaScript API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#createServer"><span class="toc-number">5.1.</span> <span class="toc-text">createServer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#InlineConfig"><span class="toc-number">5.2.</span> <span class="toc-text">InlineConfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ViteDevServer"><span class="toc-number">5.3.</span> <span class="toc-text">ViteDevServer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#build"><span class="toc-number">5.4.</span> <span class="toc-text">build</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#resolveConfig"><span class="toc-number">5.5.</span> <span class="toc-text">resolveConfig</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div class="post-bg" id="nav" style="background-image: url(/img/coverimg/vue.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">王小明</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item Home"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item Archives"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item Tag"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tag</span></a></div><div class="menus_item Categories"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item Link"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item About"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">vite 文档学习</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-04-09 11:03:10"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-04-09</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-04-09 11:05:06"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-04-09</span></time></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">8.3k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 33 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2021/04/09/vite-%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2021/04/09/vite-%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h3 id="vite创建项目"><a href="#vite创建项目" class="headerlink" title="vite创建项目"></a>vite创建项目</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> npm</span></span><br><span class="line">npm init @vitejs/app</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yarn</span></span><br><span class="line">yarn create @vitejs/app</span><br></pre></td></tr></table></figure>

<p>这里用的 <code>npm</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PS D:\桌面\vite&gt; npm init @vitejs/app</span><br><span class="line">npx: 5 安装成功，用时 4.652 秒</span><br><span class="line">√ Project name: · my-app  # 自己项目名</span><br><span class="line"></span><br><span class="line">Scaffolding project in D:\桌面\vite\my-app...</span><br><span class="line">? Select a template: ...  # 选择模板</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> vanilla</span></span><br><span class="line">  vue</span><br><span class="line">  vue-ts</span><br><span class="line">  react</span><br><span class="line">  react-ts</span><br><span class="line">  preact</span><br><span class="line">  preact-ts</span><br><span class="line">  lit-element</span><br><span class="line">  lit-element-ts</span><br><span class="line">  svelte</span><br><span class="line">  svelte-ts</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 选择模板后就会叫你 <span class="built_in">cd</span> 进去 然后执行 npm install</span></span><br><span class="line">Done. Now run:</span><br><span class="line"></span><br><span class="line">  cd my-app</span><br><span class="line">  npm install</span><br><span class="line">  npm run dev</span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="配置文件解析"><a href="#配置文件解析" class="headerlink" title="配置文件解析"></a>配置文件解析</h4><p>当以命令方式运行 <code>vite</code> 时,  <code>Vite</code> 会自动解析 项目目录下名为 <code>vite.config.js</code> 的文件</p>
<p>最基础的配置文件大概是下面这个样子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 配置项</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是, 即使没有在项目中的 <code>package.json</code> 中开启 <code>type: &quot;module&quot;</code> , <code>Vite</code> 也支持在配置文件中是用 <code>ESM</code> 语法, 这种情况下, 配置文件是在加载之前自动预处理过的</p>
<p>当然我们, 也可以自定义 <code>vite</code> 的配置文件(在当前的工作目录 ==cwd== 下去解析)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vite --config my-config.js</span><br></pre></td></tr></table></figure>

<h4 id="配置智能提示"><a href="#配置智能提示" class="headerlink" title="配置智能提示"></a>配置智能提示</h4><p>因为  <code>Vite</code> 本身附带 <code>Typescript</code> 类型, 所以你可以通过 <code>IDE</code> 和<code>jsdoc</code>  的配合来进行智能提示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type <span class="type">&#123;import('vite').UserConfig&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="comment">// 配置项</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> config</span><br></pre></td></tr></table></figure>

<p>也可以使用 <code>defineConfig</code> 辅助函数, 这样不用  <code>jsdoc</code>  注解也可以获取类型提示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">'vite'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  <span class="comment">// 配置项</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>同时 <code>Vite</code> 也是支持 <code>TypeScript</code> 的, 所以就可以直接在 <code>vite.config.ts</code> 中使用 <code>defineConfig</code> </p>
<h4 id="情景配置"><a href="#情景配置" class="headerlink" title="情景配置"></a>情景配置</h4><p>如果配置文件需要基于 (<code>serve</code> 或者 <code>build</code> ) 命令或者不同的模式来决定选项, 则可以导出这样的一个函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(<span class="function">(<span class="params">&#123; command, mode &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (command === <span class="string">'serve'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      plugins: [vue()]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      plugins: [vue()]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="异步配置"><a href="#异步配置" class="headerlink" title="异步配置"></a>异步配置</h4><p>如果配置需要调用一个异步函数, 也可以转而导出一个异步函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> asyncFetchData();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    plugins: [vue()]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="共享配置"><a href="#共享配置" class="headerlink" title="共享配置"></a>共享配置</h4><h5 id="root"><a href="#root" class="headerlink" title="root"></a>root</h5><ul>
<li><p>类型:  <code>string</code></p>
</li>
<li><p>默认:  <code>process.cwd</code></p>
<p>项目的根目录( <code>index.html</code>所在的位置 ), 可以是一个绝对路径, 或者说是一个相对于该配置文件本身的路径</p>
<p>可以使用 <code>vite serve some/sub/dir</code> 来指定一个替代的根目录</p>
</li>
</ul>
<h5 id="base"><a href="#base" class="headerlink" title="base"></a>base</h5><ul>
<li><p>类型:  <code>string</code></p>
</li>
<li><p>默认:  <code>/</code></p>
<p>开发或者生产环境服务的公共基础路径, 合法的值包括以下几种: </p>
<ol>
<li>绝对 <code>URL</code> 路径名, 例如 <code>/foo/</code></li>
<li>完整的 <code>URL</code>, 例如 <code>https://foo.com/</code></li>
<li>空字符串或 <code>./</code> (用于开发环境)</li>
</ol>
</li>
</ul>
<h5 id="mode"><a href="#mode" class="headerlink" title="mode"></a>mode</h5><ul>
<li><p>类型: <code>string</code> </p>
</li>
<li><p>默认:  <code>development</code> , <code>production</code></p>
<p>在配置中指明将会把 ==serve== 和 ==build== 时的模式都覆盖掉, 也可以通过命令行 <code>--mode</code> 选项来重写</p>
</li>
</ul>
<h5 id="define"><a href="#define" class="headerlink" title="define"></a>define</h5><ul>
<li><p>类型:  <code>Record&lt;string, string&gt;</code></p>
<p>定义全局常量替换方式, 其中每项在开发环境下会被定义在全局, 而在构建时被静态替换</p>
<ol>
<li>从 <code>2.0.0-beta.70</code> 版本开始, 字符串值将作为一个直接的表达式, 所以如果定义为了一个字符串常量, 它需要被显式地引用(例如: 通过 <code>JSON.stringify</code>)</li>
<li>替换只会在匹配到周围是单词边界 (<code>\b</code>) 时执行</li>
</ol>
<p>由于它是通过直接替换文本实现的, 因此无需任何语法分析, 我们建议只对 CONSTANTS 使用 <code>define</code></p>
<p>例如: <code>process.env.FOO</code> 和 <code>__APP_VERSION__</code> 就非常适合, 但 <code>process</code> 或 <code>global</code> 不应使用此选项</p>
</li>
</ul>
<h5 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h5><ul>
<li><p>类型:  <code>(Plugin | Plugin[])[]</code></p>
<p>将要用到的插件数组, Falsy 虚值的插件将被忽略, 插件数组将被扁平化 (flatten)</p>
</li>
</ul>
<h5 id="publicDir"><a href="#publicDir" class="headerlink" title="publicDir"></a>publicDir</h5><ul>
<li><p>类型:  <code>string</code></p>
</li>
<li><p>默认:  <code>public</code></p>
<p>作为静态资源服务的文件夹, 这个目录中的文件会在开发中被服务于 <code>/</code>, 在开发模式时, 会被拷贝到 <code>outDir</code> 的根目录, 并没有转换, 永远只是复制到这里, 该值可以是文件系统的绝对路径, 也可以是相对于项目的根目录路径</p>
</li>
</ul>
<h5 id="resolve-alias"><a href="#resolve-alias" class="headerlink" title="resolve.alias"></a>resolve.alias</h5><ul>
<li><p>类型:  <code>Record&lt;string, string&gt; | Array&lt;{find: string | RegExp, replacement: string}&gt;</code></p>
<p>将会被传递到 <code>@rollup/plugin-alias</code> 作为 <a href="https://github.com/rollup/plugins/tree/master/packages/alias#entries" target="_blank" rel="noopener">entries 的选项</a> , 也可以是一个对象, 或一个 <code>{ find, replacement }</code> 的数组</p>
<p>当使用文件系统路径的别名时, 请始终使用绝对路径, 相对路径的别名值会被原封不动地使用, 因此无法被正常解析</p>
</li>
</ul>
<h5 id="resolve-dedupe"><a href="#resolve-dedupe" class="headerlink" title="resolve.dedupe"></a>resolve.dedupe</h5><ul>
<li><p>类型:  <code>string[]</code></p>
<p>如果你在你的应用程序中有相同依赖的副本 (比如 monorepos), 使用这个选项来强制 <code>Vite</code> 总是将列出的依赖关系解析到相同的副本 (从项目根目录)</p>
</li>
</ul>
<h5 id="resolve-conditions"><a href="#resolve-conditions" class="headerlink" title="resolve.conditions"></a>resolve.conditions</h5><ul>
<li><p>类型:  <code>string[]</code></p>
<p>在解析包的 <a href="https://nodejs.org/api/packages.html#packages_conditional_exports" target="_blank" rel="noopener">情景导出</a> 时允许的附加条件</p>
<p>一个带有情景导出的包可能在它的 <code>package.json</code> 中有以下 <code>exports</code> 字段: </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"exports"</span>: &#123;</span><br><span class="line">    <span class="attr">"."</span>: &#123;</span><br><span class="line">      <span class="attr">"import"</span>: <span class="string">"./index.esm.js"</span>,</span><br><span class="line">      <span class="attr">"require"</span>: <span class="string">"./index.cjs.js"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里, <code>import</code> 和 <code>require</code> 被称为“情景”, 情景可以嵌套, 并且应该从最特定的到最不特定的指定</p>
<p><code>Vite</code>有一个”允许的情景”列表和并且会匹配列表中第一个情景, 默认允许的情景是: <code>import</code>, <code>module</code>, <code>browser</code>, <code>default</code>, 和基于当前情景为 <code>production/development</code>, <code>resolve.conditions</code> 配置项使得可以指定其他允许的情景</p>
</li>
</ul>
<p>resolve.mainFields</p>
<ul>
<li><p>类型:  <code>string[]</code></p>
</li>
<li><p>默认:  <code>[&#39;module&#39;, &#39;jsnext:main&#39;, &#39;jsnext&#39;]</code></p>
<p><code>package.json</code> 中，在解析包的入口点时尝试的字段列表, 注意, 这比从 <code>exports</code> 字段解析的情景导出优先级低: 如果一个入口点从 <code>exports</code> 成功解析主字段将被忽略</p>
</li>
</ul>
<h5 id="resolve-extensions"><a href="#resolve-extensions" class="headerlink" title="resolve.extensions"></a>resolve.extensions</h5><ul>
<li><p>类型:  <code>string[]</code></p>
</li>
<li><p>默认: <code>[&#39;.mjs&#39;, &#39;.js&#39;, &#39;.ts&#39;, &#39;.jsx&#39;, &#39;.tsx&#39;, &#39;.json&#39;]</code></p>
<p>导入时想要省略的扩展名列表, 注意, ==不建议== 忽略自定义导入类型的扩展名 (例如：<code>.vue</code>), 因为它会干扰 IDE 和类型支持</p>
</li>
</ul>
<h5 id="css-modules"><a href="#css-modules" class="headerlink" title="css.modules"></a>css.modules</h5><ul>
<li><p>类型: </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> CSSModulesOptions &#123;</span><br><span class="line">  scopeBehaviour?: <span class="string">'global'</span> | <span class="string">'local'</span></span><br><span class="line">  globalModulePaths?: <span class="built_in">string</span>[]</span><br><span class="line">  generateScopedName?:</span><br><span class="line">    | <span class="built_in">string</span></span><br><span class="line">    | <span class="function">(<span class="params">(<span class="params">name: <span class="built_in">string</span>, filename: <span class="built_in">string</span>, css: <span class="built_in">string</span></span>) =&gt; <span class="built_in">string</span></span>)</span></span><br><span class="line"><span class="function">  <span class="params">hashPrefix</span>?: <span class="params">string</span></span></span><br><span class="line"><span class="function">  /**</span></span><br><span class="line"><span class="function">   * 默认：'<span class="params">camelCaseOnly</span>'</span></span><br><span class="line"><span class="function">   */</span></span><br><span class="line"><span class="function">  <span class="params">localsConvention</span>?: '<span class="params">camelCase</span>' | '<span class="params">camelCaseOnly</span>' | '<span class="params">dashes</span>' | '<span class="params">dashesOnly</span>'</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<p>配置 CSS modules 的行为, 选项将被传递给 <a href="https://github.com/css-modules/postcss-modules" target="_blank" rel="noopener">postcss-modules</a> </p>
</li>
</ul>
<h5 id="css-postcss"><a href="#css-postcss" class="headerlink" title="css.postcss"></a>css.postcss</h5><ul>
<li><p>类型: string | (postcss.ProcessOptions &amp; { plugins?: postcss.Plugin[] })</p>
<p>内联的 PostCSS 配置 (格式同 <code>postcss.config.js</code>), 或者一个(默认基于项目根目录的) 自定义的 PostCSS 配置路径, 其路径搜索是通过 <a href="https://github.com/postcss/postcss-load-config" target="_blank" rel="noopener">postcss-load-config</a> 实现的</p>
<p>注意, 如果提供了该内联配置, <code>Vite</code>  将不会搜索其他 PostCSS 配置源</p>
</li>
</ul>
<h5 id="css-preprocessorOptions"><a href="#css-preprocessorOptions" class="headerlink" title="css.preprocessorOptions"></a>css.preprocessorOptions</h5><ul>
<li><p>类型:  <code>Record&lt;string, object&gt;</code></p>
<p>指定传递给 CSS 预处理器的选项, 例如:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  css: &#123;</span><br><span class="line">    preprocessorOptions: &#123;</span><br><span class="line">      scss: &#123;</span><br><span class="line">        additionalData: <span class="string">`$injectedColor: orange;`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="json-namedExports"><a href="#json-namedExports" class="headerlink" title="json.namedExports"></a>json.namedExports</h5><ul>
<li><p>类型:  <code>boolean</code></p>
</li>
<li><p>默认:  <code>true</code></p>
<p>是否支持从 <code>.json</code> 文件中进行按名导入</p>
</li>
</ul>
<h5 id="json-stringify"><a href="#json-stringify" class="headerlink" title="json.stringify"></a>json.stringify</h5><ul>
<li><p>类型:  <code>boolean</code></p>
</li>
<li><p>默认:  <code>false</code></p>
<p>若设置为 <code>true</code>, 导入的 JSON 会被转换为 <code>export default JSON.parse(&quot;...&quot;)</code> 会比转译成对象字面量性能更好, 尤其是当 JSON 文件较大的时候</p>
<p>开启此项, 则会禁用按名导入</p>
</li>
</ul>
<h5 id="esbuild"><a href="#esbuild" class="headerlink" title="esbuild"></a>esbuild</h5><ul>
<li><p>类型:  <code>ESBuildOptions | false</code></p>
<p><code>ESBuildOptions</code> 继承自 <a href="https://esbuild.github.io/api/#transform-api" target="_blank" rel="noopener">esbuild 转换选项</a> , 最常见的用例是自定义 JSX: </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  esbuild: &#123;</span><br><span class="line">    jsxFactory: <span class="string">'h'</span>,</span><br><span class="line">    jsxFragment: <span class="string">'Fragment'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>默认情况下, ESbuild 应用在 <code>ts</code>, <code>jsx</code>, <code>tsx</code> 文件, 你可以通过 <code>esbuild.include</code> 和 <code>esbuild.exclude</code> 对其进行配置, 它们两个配置的类型是<code>string | RegExp | (string | RegExp)[]</code></p>
<p>此外, 你还可以通过<code>esbuild.jsxInject</code>来自动为每一个被 ESbuild 转换的文件注入 JSX helper</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  esbuild: &#123;</span><br><span class="line">    jsxInject: <span class="string">`import React from 'react'`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>设置为 <code>false</code> 来禁用 ESbuild 转换</p>
</li>
</ul>
<h5 id="assetsInclude"><a href="#assetsInclude" class="headerlink" title="assetsInclude"></a>assetsInclude</h5><ul>
<li><p>类型:  <code>string | RegExp | (string | RegExp)[]</code></p>
<p>指定其他文件类型作为静态资源处理, 因此: </p>
<ul>
<li>当从 HTML 引用它们或直接通过 <code>fetch</code> 或 XHR 请求它们时, 它们将被插件转换管道排除在外</li>
<li>从 JavaScript 导入它们将返回解析后的 URL 字符串 (如果你有一个 <code>enforce: &#39;pre&#39;</code> 插件来处理不同的资产类型, 这可能会被覆盖)</li>
</ul>
<p>内建支持的资源类型列表可以在 <a href="https://github.com/vitejs/vite/blob/main/packages/vite/src/node/constants.ts" target="_blank" rel="noopener">这里</a> 找到</p>
</li>
</ul>
<h5 id="logLevel"><a href="#logLevel" class="headerlink" title="logLevel"></a>logLevel</h5><ul>
<li><p>类型: <code>&#39;info&#39; | &#39;warn&#39; | &#39;error&#39; | &#39;silent&#39;</code> </p>
<p>调整控制台输出的级别, 默认为 <code>&#39;info&#39;</code></p>
</li>
</ul>
<h5 id="clearScreen"><a href="#clearScreen" class="headerlink" title="clearScreen"></a>clearScreen</h5><ul>
<li><p>类型: <code>boolean</code></p>
</li>
<li><p>默认:  <code>true</code></p>
<p>设为 <code>false</code> 可以避免 <code>Vite</code> 清屏而错过在终端中打印某些关键信息。命令行模式下请通过 <code>--clearScreen false</code> 设置</p>
</li>
</ul>
<h4 id="Server-Options"><a href="#Server-Options" class="headerlink" title="Server Options"></a>Server Options</h4><h5 id="server-host"><a href="#server-host" class="headerlink" title="server.host"></a>server.host</h5><ul>
<li><p>类型:  <code>string</code></p>
<p>指定服务器的主机名</p>
</li>
</ul>
<h5 id="server-port"><a href="#server-port" class="headerlink" title="server.port"></a>server.port</h5><ul>
<li><p>类型:  <code>number</code></p>
<p>指定服务器端口, 注意: 如果端口已经被使用, <code>Vite</code> 会自动尝试下一个可用的端口, 所以这可能不是服务器最终监听的实际端口</p>
</li>
</ul>
<h5 id="server-strictPort"><a href="#server-strictPort" class="headerlink" title="server.strictPort"></a>server.strictPort</h5><ul>
<li><p>类型:  <code>boolean</code></p>
<p>设为 <code>true</code> 时若端口已被占用则会直接退出, 而不是尝试下一个可用端口</p>
</li>
</ul>
<h5 id="server-https"><a href="#server-https" class="headerlink" title="server.https"></a>server.https</h5><ul>
<li><p>类型:  <code>boolean | https.ServerOptions</code></p>
<p>启用 TLS + HTTP/2, 注意当 <a href="https://cn.vitejs.dev/config/#server-proxy" target="_blank" rel="noopener"><code>server.proxy</code> option</a> 也被使用时, 将会仅使用 TLS</p>
<p>这个值也可以是一个传递给 <code>https.createServer()</code> 的 <a href="https://nodejs.org/api/https.html#https_https_createserver_options_requestlistener" target="_blank" rel="noopener">选项对象</a> </p>
</li>
</ul>
<h5 id="server-open"><a href="#server-open" class="headerlink" title="server.open"></a>server.open</h5><ul>
<li><p>类型:  <code>boolean | string</code></p>
<p>在服务器启动时自动在浏览器中打开应用程序, 当此值为字符串时, 会被用作 URL 的路径名</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  server: &#123;</span><br><span class="line">    open: <span class="string">'/docs/index.html'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="server-proxy"><a href="#server-proxy" class="headerlink" title="server.proxy"></a>server.proxy</h5><ul>
<li><p>类型:  <code>Record&lt;string, string | ProxyOptions&gt;</code></p>
<p>为开发服务器配置自定义代理规则, 期望接收一个 <code>{ key: options }</code> 对象, 如果 key 值以 <code>^</code> 开头, 将会被解释为 <code>RegExp</code></p>
<p>使用 <a href="https://github.com/http-party/node-http-proxy" target="_blank" rel="noopener"><code>http-proxy</code> </a>, 完整选项详见 <a href="https://github.com/http-party/node-http-proxy#options" target="_blank" rel="noopener">此处</a> </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  server: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="comment">// 字符串简写写法</span></span><br><span class="line">      <span class="string">'/foo'</span>: <span class="string">'http://localhost:4567/foo'</span>,</span><br><span class="line">      <span class="comment">// 选项写法</span></span><br><span class="line">      <span class="string">'/api'</span>: &#123;</span><br><span class="line">        target: <span class="string">'http://jsonplaceholder.typicode.com'</span>,</span><br><span class="line">        changeOrigin: <span class="literal">true</span>,</span><br><span class="line">        rewrite: <span class="function">(<span class="params">path</span>) =&gt;</span> path.replace(<span class="regexp">/^\/api/</span>, <span class="string">''</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 正则表达式写法</span></span><br><span class="line">      <span class="string">'^/fallback/.*'</span>: &#123;</span><br><span class="line">        target: <span class="string">'http://jsonplaceholder.typicode.com'</span>,</span><br><span class="line">        changeOrigin: <span class="literal">true</span>,</span><br><span class="line">        rewrite: <span class="function">(<span class="params">path</span>) =&gt;</span> path.replace(<span class="regexp">/^\/fallback/</span>, <span class="string">''</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="server-cors"><a href="#server-cors" class="headerlink" title="server.cors"></a>server.cors</h5><ul>
<li><p>类型: <code>boolean | CorsOptions</code></p>
<p>为开发服务器配置 CORS, 默认启用并允许任何源, 传递一个 <a href="https://github.com/expressjs/cors" target="_blank" rel="noopener">选项对象</a> 来调整行为或设为 <code>false</code> 表示禁用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  server: &#123;</span><br><span class="line">    cors: &#123;</span><br><span class="line">      origin: <span class="string">'*'</span>,</span><br><span class="line">      methods: <span class="string">'GET,HEAD,PUT,PATCH,POST,DELETE'</span>,</span><br><span class="line">      preflightContinue: <span class="literal">false</span>,</span><br><span class="line">      optionsSuccessStatus: <span class="number">204</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="server-force"><a href="#server-force" class="headerlink" title="server.force"></a>server.force</h5><ul>
<li><p>类型:  <code>boolean</code></p>
</li>
<li><p>相关内容:  <a href="https://cn.vitejs.dev/guide/dep-pre-bundling.html" target="_blank" rel="noopener">Dependency Pre-Bundling</a></p>
<p>设置为 <code>true</code> 强制使依赖预构建</p>
</li>
</ul>
<h5 id="server-hmr"><a href="#server-hmr" class="headerlink" title="server.hmr"></a>server.hmr</h5><ul>
<li><p>类型:  <code>boolean | { protocol?: string, host?: string, port?: number, path?: string, timeout?: number, overlay?: boolean }</code></p>
<p>禁用或配置 HMR 连接(用于 HMR websocket 必须使用不同的 http 服务器地址的情况)</p>
<p>设置 <code>server.hmr.overlay</code> 为 <code>false</code> 可以禁用服务器错误遮罩层</p>
</li>
</ul>
<p>server.watch</p>
<ul>
<li><p>类型:  <code>object</code></p>
<p>传递给 <a href="https://github.com/paulmillr/chokidar#api" target="_blank" rel="noopener">chokidar</a> 的文件系统监视器选项</p>
</li>
</ul>
<h4 id="Build-Options"><a href="#Build-Options" class="headerlink" title="Build Options"></a>Build Options</h4><h5 id="build-target"><a href="#build-target" class="headerlink" title="build.target"></a>build.target</h5><ul>
<li><p>类型:  <code>string</code></p>
</li>
<li><p>默认:  <code>modules</code></p>
</li>
<li><p>相关内容: <a href="https://cn.vitejs.dev/guide/build.html#browser-compatibility" target="_blank" rel="noopener">浏览器兼容性</a></p>
<p>设置最终构建的浏览器兼容目标, 默认值是一个 <code>Vite</code> 特有的值, <code>&#39;modules&#39;</code>, 这是指 <a href="https://caniuse.com/es6-module" target="_blank" rel="noopener">支持原生 ES 模块的浏览器</a> </p>
<p>另一个特殊值是 “esnext” —— 即指执行 minify 转换(作最小化压缩)并假设有原生动态导入支持</p>
<p>转换过程将会由 esbuild 执行, 并且此值应该是一个合法的 <a href="https://esbuild.github.io/api/#target" target="_blank" rel="noopener">esbuild 目标选项</a> , 自定义目标也可以是一个 ES 版本(例如：<code>es2015</code>), 一个浏览器版本(例如：<code>chrome58</code>)或是多个目标组成的一个数组</p>
<p>注意, 如果代码包含不能被 <code>esbuild</code> 安全地编译的特性, 那么构建将会失败, 查看 <a href="https://esbuild.github.io/api/#target" target="_blank" rel="noopener">esbuild 文档</a> 获取更多细节</p>
</li>
</ul>
<h5 id="build-polyfillDynamicImport"><a href="#build-polyfillDynamicImport" class="headerlink" title="build.polyfillDynamicImport"></a>build.polyfillDynamicImport</h5><ul>
<li><p>类型:  <code>boolean</code></p>
</li>
<li><p>默认:  <code>true</code> unless  <code>build.target</code> is  <code>&#39;esnext&#39;</code> </p>
<p>决定是否自动注入 <a href="https://github.com/GoogleChromeLabs/dynamic-import-polyfill" target="_blank" rel="noopener">对动态导入的 polyfill</a> </p>
<p>该 polyfill 将被自动注入进每个 <code>index.html</code> 入口的代理模块中, 如果某此构建通过 <code>build.rollupOptions.input</code> 选项, 配置成了使用非 HTML 的自定义入口, 则有必要在你的自定义入口中手动引入此 polyfill:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'vite/dynamic-import-polyfill'</span></span><br></pre></td></tr></table></figure>

<p>注意: 该 polyfill <strong>不会</strong> 应用于 <a href="https://cn.vitejs.dev/guide/build.html#library-mode" target="_blank" rel="noopener">库模式</a>, 如果你需要支持不含原生动态导入功能的浏览器, 可能要避免在你的库中使用它</p>
</li>
</ul>
<h5 id="build-outDir"><a href="#build-outDir" class="headerlink" title="build.outDir"></a>build.outDir</h5><ul>
<li><p>类型:  <code>string</code></p>
</li>
<li><p>默认:  <code>dist</code></p>
<p>指定输出路径</p>
</li>
</ul>
<h5 id="build-assetsDir"><a href="#build-assetsDir" class="headerlink" title="build.assetsDir"></a>build.assetsDir</h5><ul>
<li><p>类型:  <code>string</code></p>
</li>
<li><p>默认:  <code>assets</code></p>
<p>指定生成静态资源的存放路径(相对于 <code>build.outDir</code>)</p>
</li>
</ul>
<h5 id="build-assetsInlineLimit"><a href="#build-assetsInlineLimit" class="headerlink" title="build.assetsInlineLimit"></a>build.assetsInlineLimit</h5><ul>
<li><p>类型:  <code>number</code></p>
</li>
<li><p>默认:  <code>4096</code></p>
<p>小于此阈值的导入或引用资源将内联为 base64 编码, 以避免额外的 http 请求, 设置为 <code>0</code> 可以完全禁用此项</p>
</li>
</ul>
<h5 id="build-cssCodeSplit"><a href="#build-cssCodeSplit" class="headerlink" title="build.cssCodeSplit"></a>build.cssCodeSplit</h5><ul>
<li><p>类型:  <code>boolean</code></p>
</li>
<li><p>默认:  <code>true</code></p>
<p>启用/禁用 CSS 代码拆分, 当启用时, 在异步 chunk 中导入的 CSS 将内联到异步 chunk 本身, 并在块加载时插入</p>
<p>如果禁用, 整个项目中的所有 CSS 将被提取到一个 CSS 文件中</p>
</li>
</ul>
<h5 id="build-sourcemap"><a href="#build-sourcemap" class="headerlink" title="build.sourcemap"></a>build.sourcemap</h5><ul>
<li><p>类型:  <code>boolean | &#39;inline&#39;</code></p>
</li>
<li><p>默认:  <code>false</code></p>
<p>构建后是否生成 source map 文件</p>
</li>
</ul>
<h4 id="依赖优化选项"><a href="#依赖优化选项" class="headerlink" title="依赖优化选项"></a>依赖优化选项</h4><ul>
<li>相关内容:  <a href="https://cn.vitejs.dev/guide/dep-pre-bundling.html" target="_blank" rel="noopener">依赖预构建</a> </li>
</ul>
<h5 id="optimizeDeps-entries"><a href="#optimizeDeps-entries" class="headerlink" title="optimizeDeps.entries"></a>optimizeDeps.entries</h5><ul>
<li><p>类型:  <code>string | string[]</code></p>
<p>默认情况下, <code>Vite</code> 会抓取你的 index.html 来检测需要预构建的依赖项, 如果指定了 <code>build.rollupOptions.input</code>, <code>Vite</code> 将转而去抓取这些入口点</p>
<p>如果这两者都不适合你的需要, 则可以使用此选项指定自定义条目 - 该值需要遵循 <a href="https://github.com/mrmlnc/fast-glob#basic-syntax" target="_blank" rel="noopener">fast-glob 模式</a> , 或者是相对于 <code>vite</code> 项目根的模式数组, 这将覆盖掉默认条目推断</p>
</li>
</ul>
<h5 id="optimizeDeps-exclude"><a href="#optimizeDeps-exclude" class="headerlink" title="optimizeDeps.exclude"></a>optimizeDeps.exclude</h5><ul>
<li><p>类型:  <code>string[]</code></p>
<p>在预构建中强制排除的依赖项</p>
</li>
</ul>
<h5 id="optimizeDeps-include"><a href="#optimizeDeps-include" class="headerlink" title="optimizeDeps.include"></a>optimizeDeps.include</h5><ul>
<li><p>类型:  <code>string[]</code></p>
<p>默认情况下, 不在 <code>node_modules</code> 中的, 链接的包不会被预构建, 使用此选项可强制预构建链接的包</p>
</li>
</ul>
<h5 id="optimizeDeps-keepNames"><a href="#optimizeDeps-keepNames" class="headerlink" title="optimizeDeps.keepNames"></a>optimizeDeps.keepNames</h5><ul>
<li><p>类型:  <code>boolean</code></p>
</li>
<li><p>默认:  <code>false</code></p>
<p>打包器有时需要重命名符号以避免冲突,  设置此项为 <code>true</code> 可以在函数和类上保留 <code>name</code> 属性,  若想获取更多详情, 请参阅 <a href="https://esbuild.github.io/api/#keep-names" target="_blank" rel="noopener"><code>keepNames</code></a> </p>
</li>
</ul>
<h4 id="SSR-选项"><a href="#SSR-选项" class="headerlink" title="SSR 选项"></a>SSR 选项</h4><blockquote>
<p>实验性</p>
<p>SSR 选项可能会在未来版本中进行调整</p>
</blockquote>
<ul>
<li>相关:  <a href="https://cn.vitejs.dev/guide/ssr.html#ssr-externals" target="_blank" rel="noopener">SSR 外部化</a> </li>
</ul>
<h5 id="ssr-external"><a href="#ssr-external" class="headerlink" title="ssr.external"></a>ssr.external</h5><ul>
<li><p>类型:  <code>string[]</code></p>
<p>列出的是要为 SSR 强制外部化的依赖</p>
</li>
</ul>
<h5 id="ssr-noExternal"><a href="#ssr-noExternal" class="headerlink" title="ssr.noExternal"></a>ssr.noExternal</h5><ul>
<li><p>类型;  <code>string[]</code></p>
<p>列出的是防止被 SSR 外部化依赖项</p>
</li>
</ul>
<h3 id="插件API"><a href="#插件API" class="headerlink" title="插件API"></a>插件API</h3><h4 id="约定"><a href="#约定" class="headerlink" title="约定"></a>约定</h4><p>如果插件不使用 <code>Vite</code> 特有的钩子, 可以实现为兼容的 Rollup 插件,  推荐使用 <a href="https://rollupjs.org/guide/zn/#conventions" target="_blank" rel="noopener">Rollup 插件名称约定</a> </p>
<ul>
<li>Rollup 插件应该有一个带 <code>rollup-plugin-</code> 前缀, 语义清晰的名称</li>
<li>在 package.json 中包含 <code>rollup-plugin</code> 和 <code>vite-plugin</code> 关键字</li>
</ul>
<p>这样，插件也可以用于纯 Rollup 或基于 WMR 的项目</p>
<p>对于 Vite 专属的插件: </p>
<ul>
<li><code>Vite</code> 插件应该有一个带 <code>vite-plugin-</code> 前缀, 语义清晰的名称</li>
<li>在 package.json 中包含 <code>vite-plugin</code> 关键字</li>
<li>在插件文档增加一部分关于为什么本插件是一个 Vite 专属插件的详细说明(如, 本插件使用了 Vite 特有的插件钩子)</li>
</ul>
<p>如果你的插件只适用于特定的框架, 它的名字应该遵循以下前缀格式</p>
<ul>
<li><code>vite-plugin-vue-</code> 前缀作为 Vue 插件</li>
<li><code>vite-plugin-react-</code> 前缀作为 React 插件</li>
<li><code>vite-plugin-svelte-</code> 前缀作为 Svelte 插件</li>
</ul>
<h4 id="插件配置"><a href="#插件配置" class="headerlink" title="插件配置"></a>插件配置</h4><p>用户会将插件添加到项目的 <code>devDependencies</code> 中并使用数组形式的 <code>plugins</code> 选项配置它们</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineComfig &#125; <span class="keyword">from</span> <span class="string">'vite'</span></span><br><span class="line"><span class="keyword">import</span> vitePlugin <span class="keyword">from</span> <span class="string">'vite-plugin-feature'</span></span><br><span class="line"><span class="keyword">import</span> rollupPlugin <span class="keyword">from</span> <span class="string">'rollup-plugin-feature'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    vitePlugin(),</span><br><span class="line">    rollupPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy" target="_blank" rel="noopener">Falsy虚值 </a> 的插件将被忽略, 可以用来轻松地启用或停用插件</p>
<p><code>plugins</code> 也可以接受将多个插件作为单个元素的预设, 这对于使用多个插件实现的复杂特性(如框架集成)很有用, 该数组将在内部被扁平化(flatten)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite-plugin-framework.js</span></span><br><span class="line"><span class="keyword">import</span> frameworkRefresh <span class="keyword">from</span> <span class="string">'vite-plugin-framework-refresh'</span></span><br><span class="line"><span class="keyword">import</span> frameworkDevtools <span class="keyword">from</span> <span class="string">'vite-plugin-framework-devtools'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">framework</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    frameworkRefresh(config),</span><br><span class="line">    frameworkDevTools(config)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineComfig &#125; <span class="keyword">from</span> <span class="string">'vite'</span></span><br><span class="line"><span class="keyword">import</span> framework <span class="keyword">from</span> <span class="string">'vite-plugin-framework'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComfig(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    framework()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h4><blockquote>
<p>TIP</p>
<p>通常的惯例是创建一个 Vite/Rollup 插件作为一个返回实际插件对象的工厂函数。该函数可以接受允许用户自定义插件行为的选项</p>
</blockquote>
<p><strong>引入一个虚拟文件</strong></p>
<p><code>src/plugin</code> 下创建一个 <code>virtual-file.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// virtual-file.js</span></span><br><span class="line"><span class="comment">// 默认导出一个方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">virtualPlugin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFileId = <span class="string">'virtual-file'</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'my-virtual-plugin'</span>, <span class="comment">// 必须的，将会显示在 warning 和 error 中</span></span><br><span class="line">    <span class="comment">// 解析</span></span><br><span class="line">    resolveId(id) &#123; <span class="comment">// 这个id 就是 import aaa from 'bbb' 中的bbb </span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"resolve"</span>)</span><br><span class="line">      <span class="built_in">console</span>.log(id)</span><br><span class="line">      <span class="keyword">if</span> (id === virtualFileId) &#123; <span class="comment">// 确认是当前的我们命中的plugin</span></span><br><span class="line">        <span class="keyword">return</span> virtualFileId <span class="comment">// 返回</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 加载</span></span><br><span class="line">    load(id) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"load"</span>)</span><br><span class="line">      <span class="built_in">console</span>.log(id)</span><br><span class="line">      <span class="keyword">if</span> (id === virtualFileId) &#123;  <span class="comment">// 命中 返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">`export const msg = "from virtual file"`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="comment">// 需要再vite.config.js 中注册自己刚才的写的自定义插件</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">'@vitejs/plugin-vue'</span>;</span><br><span class="line"><span class="keyword">import</span> virtualPlugin <span class="keyword">from</span> <span class="string">'./src/plugins/virtual-file'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [vue(), virtualPlugin()],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; msg &#125; <span class="keyword">from</span> <span class="string">'virtual-file'</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(msg)</span><br><span class="line"></span><br><span class="line">createApp(App).mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 控制台输出</span></span><br><span class="line">resolve</span><br><span class="line">virtual-file</span><br><span class="line">resolve</span><br><span class="line">/@id/virtual-file</span><br><span class="line">resolve</span><br><span class="line">/@id/virtual-file</span><br><span class="line">resolve</span><br><span class="line">virtual-file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 浏览器控制台输出</span></span><br><span class="line">[vite] connecting... client:202 </span><br><span class="line">[vite] connected.    main.js:5 </span><br><span class="line">from virtual file # 这是我们打印出来的msg</span><br></pre></td></tr></table></figure>

<h4 id="通用的钩子"><a href="#通用的钩子" class="headerlink" title="通用的钩子"></a>通用的钩子</h4><p>在开发中, <code>Vite</code> 开发服务器会创建一个插件容器来调用 <a href="https://rollupjs.org/guide/zn/#build-hooks" target="_blank" rel="noopener">Rollup 构建钩子</a> , 与 Rollup 如出一辙</p>
<p>以下钩子在服务器启动时被调用</p>
<ul>
<li><code>options</code></li>
<li><code>buildStart</code></li>
</ul>
<p>以下钩子会在每个传入模块请求的时候被调用</p>
<ul>
<li><code>resolvId</code></li>
<li><code>load</code></li>
<li><code>transform</code></li>
</ul>
<p>以下钩子在服务器被关闭时调用</p>
<ul>
<li><code>buildEnd</code></li>
<li><code>closeBundle</code></li>
</ul>
<p>请注意 <code>moduleParsed</code> 钩子 ==不是==在开发中被调用的, 因为 <code>Vite</code> 为了性能会避免完整的 AST 解析</p>
<p><a href="https://rollupjs.org/guide/zn/#output-generation-hooks" target="_blank" rel="noopener">Output Generation Hooks </a> (除了 <code>closeBundle</code>)  ==不是==  在开发中被调用的, 你可以认为 <code>Vite</code>  的开发服务器只调用了 <code>rollup.rollup()</code> 而没有调用 <code>bundle.generate()</code></p>
<h4 id="Vite-独有的钩子"><a href="#Vite-独有的钩子" class="headerlink" title="Vite 独有的钩子"></a>Vite 独有的钩子</h4><p><code>Vite</code> 插件也可以提供钩子来服务于特定的<code>Vite</code> 目标, 这些钩子会被 Rollup 忽略</p>
<h5 id="config"><a href="#config" class="headerlink" title="config"></a>config</h5><ul>
<li><p>类型:  <code>(config: UserConfig, env: { mode: string, command: string }) =&gt; UserConfig | null | void</code></p>
</li>
<li><p>种类:  <code>sync</code> , <code>sequential</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Plugin &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">virtualPlugin</span>(<span class="params"></span>): <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFileId = <span class="string">'virtual-file'</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'virtual-plugin'</span>, <span class="comment">// 必须的，将会显示在 warning 和 error 中</span></span><br><span class="line">    config(config, &#123; command &#125;) &#123;</span><br><span class="line">      <span class="comment">// 返回部分配置 (是推荐使用的)</span></span><br><span class="line">      <span class="comment">// return &#123;</span></span><br><span class="line">      <span class="comment">//   alias: &#123;</span></span><br><span class="line">      <span class="comment">//     foo: 'bar'</span></span><br><span class="line">      <span class="comment">//   &#125;</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 根据 command 来调整 配置</span></span><br><span class="line">      <span class="keyword">if</span> (command === <span class="string">'build'</span>) &#123;</span><br><span class="line">        <span class="comment">// todo</span></span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// todo</span></span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意</p>
<p>用户插件在运行这个钩子之前会被解析，因此在 <code>config</code> 钩子中注入其他插件不会有任何效果。</p>
</blockquote>
</li>
</ul>
<h5 id="configResolved"><a href="#configResolved" class="headerlink" title="configResolved"></a>configResolved</h5><ul>
<li><p>类型 :  <code>(config: ResolveConfig) =&gt; void</code></p>
</li>
<li><p>种类:  <code>sync</code> , <code>sequential</code></p>
<p>在解析 <code>Vite</code> 配置后调用, 使用这个钩子读取和存储最终解析的配置, 当插件需要根据运行的命令做一些不同的事情时, 它也很有用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Plugin, ResolvedConfig &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">virtualPlugin</span>(<span class="params"></span>): <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFileId = <span class="string">'virtual-file'</span>;</span><br><span class="line">  <span class="keyword">let</span> config: ResolvedConfig;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">		<span class="comment">// ...省略</span></span><br><span class="line">    configResolved(resolveConfig) &#123;</span><br><span class="line">      config = resolveConfig;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 使用其他钩子存储的配置</span></span><br><span class="line">    transform(code, id) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config.command === <span class="string">'serve'</span>) &#123;</span><br><span class="line">        <span class="comment">// serve: 用于启动开发服务器的插件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// build: 调用 Rollup 的插件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="configureServer"><a href="#configureServer" class="headerlink" title="configureServer"></a>configureServer</h5><ul>
<li><p>类型:  <code>(server: ViteDevServer) =&gt; (() =&gt; void) | void | Promise&lt;(() =&gt; void) | void&gt;</code></p>
</li>
<li><p>种类:  <code>sync</code> , <code>sequential</code></p>
<p><strong>此外请看</strong> <a href="https://cn.vitejs.dev/guide/api-javascript.html#vitedevserver" target="_blank" rel="noopener">ViteDevServer</a> </p>
<p>是用于配置开发服务器的钩子, 最常见的用例是在内部 <a href="https://github.com/senchalabs/connect" target="_blank" rel="noopener">connect</a>  应用程序中添加自定义中间件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Plugin, ResolvedConfig &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">virtualPlugin</span>(<span class="params"></span>): <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFileId = <span class="string">'virtual-file'</span>;</span><br><span class="line">  <span class="keyword">let</span> config: ResolvedConfig;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">    configureServer(server) &#123;</span><br><span class="line">      server.middlewares.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 自定义请求处理...</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注入后置中间件</strong></p>
<p><code>configureServer</code> 钩子将在内部中间件被安装前调用, 所以自定义的中间件将会默认会比内部中间件早运行, 如果你想注入一个在内部中间件 之后 运行的中间件, 你可以从 <code>configureServer</code> 返回一个函数, 将会在内部中间件安装后被调用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Plugin, ResolvedConfig &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">virtualPlugin</span>(<span class="params"></span>): <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFileId = <span class="string">'virtual-file'</span>;</span><br><span class="line">  <span class="keyword">let</span> config: ResolvedConfig;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">    configureServer(server) &#123;</span><br><span class="line">      <span class="comment">// 返回一个在内部中间件安装后被调用的后置钩子</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        server.middlewares.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 自定义请求处理...</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>存储服务器访问</strong></p>
<p>在某些情况下, 其他插件钩子可能需要访问开发服务器实例 (例如访问 websocket 服务器, 文件系统监视程序或模块图), 这个钩子也可以用来存储服务器实例以供其他钩子访问</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Plugin, ResolvedConfig, ViteDevServer &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">virtualPlugin</span>(<span class="params"></span>): <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFileId = <span class="string">'virtual-file'</span>;</span><br><span class="line">  <span class="keyword">let</span> config: ResolvedConfig;</span><br><span class="line">  <span class="keyword">let</span> server: ViteDevServer;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">    configureServer(_server) &#123;</span><br><span class="line">      server = _server;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 使用其他钩子存储的配置</span></span><br><span class="line">    transform(code, id) &#123;</span><br><span class="line">      <span class="keyword">if</span> (server) &#123;</span><br><span class="line">        <span class="comment">// todo</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ...省略</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意 <code>configureServer</code> 在运行生产版本时不会被调用, 所以其他钩子需要注意防止它的缺失</p>
</li>
</ul>
<h5 id="transformIndexHtml"><a href="#transformIndexHtml" class="headerlink" title="transformIndexHtml"></a>transformIndexHtml</h5><ul>
<li><p>类型:  <code>IndexHtmlTransformHook | { enforce?: &#39;pre&#39; | &#39;post&#39; transform: IndexHtmlTransformHook }</code></p>
</li>
<li><p>种类:  <code>async</code>, <code>sequential</code></p>
<p>转换 <code>index.html</code> 的专用钩子, 钩子接收当前的 HTML 字符串和转换上下文, 上下文在开发期间暴露<code>ViteDevServer</code> 实例, 在构建期间暴露 Rollup 输出的包</p>
<p>这个钩子可以是异步的, 并且可以返回以下其中之一: </p>
<ul>
<li><p>经过转换的 HTML 字符串</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Plugin, ResolvedConfig, ViteDevServer &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">virtualPlugin</span>(<span class="params"></span>): <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFileId = <span class="string">'virtual-file'</span>;</span><br><span class="line">  <span class="keyword">let</span> config: ResolvedConfig;</span><br><span class="line">  <span class="keyword">let</span> server: ViteDevServer;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">    transformIndexHtml(html, ctx) &#123;</span><br><span class="line">      <span class="comment">// 在这里可以访问 ctx.server 就是那个 ViteDevServer 实例</span></span><br><span class="line">      <span class="built_in">console</span>.log(html)</span><br><span class="line">      <span class="keyword">return</span> html.replace(</span><br><span class="line">        /&lt;title&gt;(.*?)&lt;\/title&gt;<span class="regexp">/,</span></span><br><span class="line"><span class="regexp">        `&lt;title&gt;Title replaced!&lt;/</span>title&gt;<span class="string">`</span></span><br><span class="line"><span class="string">      )</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    // ...省略</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 终端打印的html</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang="en"&gt;</span></span><br><span class="line"><span class="string">  &lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset="UTF-8" /&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel="icon" href="/favicon.ico" /&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Vite App&lt;/title&gt;</span></span><br><span class="line"><span class="string">  &lt;/head&gt;</span></span><br><span class="line"><span class="string">  &lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div id="app"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;script type="module" src="/src/main.ts"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 打印的 ctx</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  path: '/index.html',</span></span><br><span class="line"><span class="string">  filename: 'D:\\桌面\\vite\\learn-ts\\index.html',</span></span><br><span class="line"><span class="string">  server: &#123; // ... &#125;,</span></span><br><span class="line"><span class="string">  bundle: undefined,</span></span><br><span class="line"><span class="string">  chunk: undefined</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>注入到现有 HTML 中的标签描述符对象数组(<code>{ tag, attrs, children }</code>), 每个标签也可以指定它应该被注入到哪里(默认是在 <code>&lt;head&gt;</code> 之前)</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Plugin, ResolvedConfig, ViteDevServer, HtmlTagDescriptor &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">virtualPlugin</span>(<span class="params"></span>): <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFileId = <span class="string">'virtual-file'</span>;</span><br><span class="line">  <span class="keyword">let</span> config: ResolvedConfig;</span><br><span class="line">  <span class="keyword">let</span> server: ViteDevServer;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">    transformIndexHtml(html, ctx) &#123;</span><br><span class="line">      <span class="keyword">const</span> tags: HtmlTagDescriptor[] = [</span><br><span class="line">        &#123;</span><br><span class="line">          tag: <span class="string">"div"</span>,</span><br><span class="line">          attrs: &#123;</span><br><span class="line">            <span class="keyword">class</span>: <span class="string">"my-example"</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          children: <span class="string">"测试"</span>,</span><br><span class="line">          injectTo: <span class="string">'body'</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">			<span class="keyword">return</span> tags</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>一个包含 <code>{ html, tags }</code> 的对象</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Plugin, ResolvedConfig, ViteDevServer, HtmlTagDescriptor &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">virtualPlugin</span>(<span class="params"></span>): <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFileId = <span class="string">'virtual-file'</span>;</span><br><span class="line">  <span class="keyword">let</span> config: ResolvedConfig;</span><br><span class="line">  <span class="keyword">let</span> server: ViteDevServer;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">    transformIndexHtml(html, ctx) &#123;</span><br><span class="line">      <span class="keyword">const</span> tags: HtmlTagDescriptor[] = [</span><br><span class="line">        &#123;</span><br><span class="line">          tag: <span class="string">"div"</span>,</span><br><span class="line">          attrs: &#123;</span><br><span class="line">            <span class="keyword">class</span>: <span class="string">"my-example"</span>,</span><br><span class="line">            style: <span class="string">"font-size: 50px"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          children: <span class="string">"测试"</span>,</span><br><span class="line">          injectTo: <span class="string">'body'</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">			<span class="keyword">return</span> &#123;</span><br><span class="line">      	html,</span><br><span class="line">        tags</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h5 id="handleHotUpdate"><a href="#handleHotUpdate" class="headerlink" title="handleHotUpdate"></a>handleHotUpdate</h5><ul>
<li><p>类型:  <code>(ctx: HmrContext) =&gt; Array&lt;ModuleNode&gt; | void | Promise&lt;Array&lt;ModuleNode&gt; | void&gt;</code></p>
<p>执行自定义 HMR 更新处理, 钩子接收一个带有以下签名的上下文对象</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> HmrContext &#123;</span><br><span class="line">  file: <span class="built_in">string</span></span><br><span class="line">  timestamp: <span class="built_in">number</span></span><br><span class="line">  modules: <span class="built_in">Array</span>&lt;ModuleNode&gt; <span class="comment">// 是受更改文件影响的模块数组, 它是一个数组, 因为单个文件可能映射到多个服务模块(例如 Vue 单文件组件)</span></span><br><span class="line">  read: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">string</span> | <span class="built_in">Promise</span>&lt;<span class="built_in">string</span>&gt; <span class="comment">// read 这是一个异步读函数, 它返回文件的内容, 之所以这样做, 是因为在某些系统上, 文件更改的回调函数可能会在编辑器完成文件更新之前过快地触发, 并 fs.readFile 直接会返回空内容, 传入的 read 函数规范了这种行为</span></span><br><span class="line">  server: ViteDevServer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>钩子可以选择</p>
<ul>
<li><p>过滤和缩小受影响的模块列表, 使 HMR 更准确</p>
</li>
<li><p>返回一个空数组, 并通过向客户端发送自定义事件来执行完整的自定义 HMR 处理</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Plugin, ResolvedConfig, ViteDevServer, HtmlTagDescriptor &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">virtualPlugin</span>(<span class="params"></span>): <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFileId = <span class="string">'virtual-file'</span>;</span><br><span class="line">  <span class="keyword">let</span> config: ResolvedConfig;</span><br><span class="line">  <span class="keyword">let</span> server: ViteDevServer;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">    handleHotUpdate(ctx) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; server &#125; = ctx;</span><br><span class="line">      server.ws.send(&#123;</span><br><span class="line">        <span class="keyword">type</span>: <span class="string">'custom'</span>,</span><br><span class="line">        event: <span class="string">'my-event'</span>,</span><br><span class="line">        data: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// return []</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...省略</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="keyword">import</span> &#123; msg &#125; <span class="keyword">from</span> <span class="string">'virtual-file'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">import</span>.meta.hot) &#123;</span><br><span class="line">  <span class="keyword">import</span>.meta.hot!.on(<span class="string">'my-event'</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行自定义更新</span></span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(msg);</span><br><span class="line">createApp(App).mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h5 id="钩子的执行顺序"><a href="#钩子的执行顺序" class="headerlink" title="钩子的执行顺序"></a>钩子的执行顺序</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plugins/myOrder.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Plugin &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">myOrder</span>(<span class="params"></span>): <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> pluginId = <span class="string">"my-order"</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'my-order'</span>,</span><br><span class="line">    <span class="comment">// vite 独有的 五个</span></span><br><span class="line">    config() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"config start"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    configResolved() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"configResolved start"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    configureServer() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"configureServer start"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    transformIndexHtml(html) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"transformIndexHtml start"</span>);</span><br><span class="line">      <span class="keyword">return</span> html</span><br><span class="line">    &#125;,</span><br><span class="line">    handleHotUpdate() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"handleHotUpdate start"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    resolveId(id) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"resolveId start"</span>);</span><br><span class="line">      <span class="keyword">if</span> (id === pluginId) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"resolveId 命中"</span>);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 下面三个 是覆盖的 rollup 的方法</span></span><br><span class="line">    load(id) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"load start"</span>);</span><br><span class="line">      <span class="keyword">if</span> (id === pluginId) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"load 命中"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`export const msg = "order order order"`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    transform() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"transform start"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    options() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"options start"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// rollup 自带的方法 还有很多  详细看 官网https://rollupjs.org/guide/zh/#</span></span><br><span class="line">    buildStart() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"buildStart start"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    buildEnd() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"buildEnd start"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    closeBundle() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"closeBundle start"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// myConfig.ts</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">'@vitejs/plugin-vue'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"><span class="keyword">import</span> myOrder <span class="keyword">from</span> <span class="string">'./src/plugins/order'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [vue(), myOrder()],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="comment">// import &#123; msg &#125; from 'virtual-file'</span></span><br><span class="line"><span class="keyword">import</span> &#123; msg &#125; <span class="keyword">from</span> <span class="string">'my-order'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(msg);</span><br><span class="line"></span><br><span class="line">createApp(App).mount(<span class="string">'#app'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="comment">// 改这个 用自己定义的</span></span><br><span class="line"><span class="string">"dev"</span>: <span class="string">"vite --config myConfig.ts"</span>,</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 执行顺序</span></span><br><span class="line">transformIndexHtml start</span><br><span class="line">load start</span><br><span class="line">load start     </span><br><span class="line">transform start</span><br><span class="line">transform start</span><br><span class="line">resolveId start</span><br><span class="line">resolveId 命中 </span><br><span class="line">resolveId start</span><br><span class="line">resolveId start</span><br><span class="line">load start</span><br><span class="line">transform start</span><br><span class="line">load start</span><br><span class="line">resolveId start</span><br><span class="line">resolveId 命中</span><br><span class="line">resolveId start</span><br><span class="line">resolveId 命中</span><br><span class="line">resolveId start</span><br><span class="line">resolveId 命中</span><br><span class="line">load start</span><br><span class="line">load 命中</span><br><span class="line">resolveId start</span><br><span class="line">resolveId 命中</span><br><span class="line">transform start</span><br><span class="line">transform start</span><br><span class="line">load start</span><br><span class="line">transform start</span><br><span class="line">transform start</span><br><span class="line">transform start</span><br><span class="line"><span class="comment">// 这里需要改动一下文件 触发</span></span><br><span class="line">handleHotUpdate start</span><br></pre></td></tr></table></figure>

<h4 id="插件顺序"><a href="#插件顺序" class="headerlink" title="插件顺序"></a>插件顺序</h4><p>一个 <code>Vite</code> 插件可以额外指定一个 <code>enforce</code> 属性(类似于 webpack 加载器)来调整它的应用顺序, <code>enforce</code> 的值可以是<code>pre</code> 或 <code>post</code>, 解析后的插件将按照以下顺序排列: </p>
<ul>
<li>Alias</li>
<li>带有 <code>enforce: &#39;pre&#39;</code> 的用户插件  (这个可以在自己定义的插件里面定义)</li>
<li>Vite 内置插件</li>
<li>没有 enforce 值的用户插件</li>
<li>Vite 构建用的插件</li>
<li>带有 <code>enforce: &#39;post&#39;</code> 的用户插件 (这个可以在自己定义的插件里面定义)</li>
</ul>
<h4 id="情景应用"><a href="#情景应用" class="headerlink" title="情景应用"></a>情景应用</h4><p>默认情况下插件在部署(serve)和构建(build)模式中都会调用, 如果插件只需要在服务或构建期间有条件地应用, 请使用 <code>apply</code> 属性指明它们仅在 <code>&#39;build&#39;</code> 或 <code>&#39;serve&#39;</code> 模式时调用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Plugin &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">applyPlugin</span>(<span class="params">apply: Plugin["apply"]</span>):<span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'apply-plugin'</span>,</span><br><span class="line">    apply,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用的时候</span></span><br><span class="line"><span class="keyword">import</span> applyPlugin <span class="keyword">from</span> <span class="string">"./src/plugins/apply-plugin"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [vue(), applyPlugin(<span class="string">"serve"</span>)],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="Rollup-插件兼容性"><a href="#Rollup-插件兼容性" class="headerlink" title="Rollup 插件兼容性"></a>Rollup 插件兼容性</h4><p>相当数量的 Rollup 插件将直接作为 Vite 插件工作(例如: <code>@rollup/plugin-alias</code> 或 <code>@rollup/plugin-json</code>), 但并不是所有的, 因为有些插件钩子在非构建式的开发服务器上下文中没有意义</p>
<p>一般来说, 只要一个 Rollup 插件符合以下标准, 那么它应该只是作为一个 Vite 插件;</p>
<ul>
<li>没有使用 <a href="https://rollupjs.org/guide/zh/#moduleparsed" target="_blank" rel="noopener"><code>moduleParsed</code></a> 钩子</li>
<li>它在打包钩子和输出钩子之间没有很强的耦合</li>
</ul>
<p>如果一个 Rollup 插件只在构建阶段有意义, 则在 <code>build.rollupOptions.plugins</code> 下指定即可</p>
<p>你也可以用 Vite 独有的属性来扩展现有的 Rollup 插件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example <span class="keyword">from</span> <span class="string">'rollup-plugin-example'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    &#123;</span><br><span class="line">      ...example(),</span><br><span class="line">      enforce: <span class="string">'post'</span>,</span><br><span class="line">      apply: <span class="string">'build'</span> <span class="comment">// 或者 'serve'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看 <a href="https://vite-rollup-plugins.patak.dev/" target="_blank" rel="noopener">Vite Rollup 插件</a> 获取兼容的官方 Rollup 插件列表及其使用指南</p>
<h4 id="路径规范化"><a href="#路径规范化" class="headerlink" title="路径规范化"></a>路径规范化</h4><p><code>Vite</code> 会在解析路径时使用 POSIX 分隔符（ / ）标准化路径, 同时也适用于 Windows 的分卷, 而另一方面, Rollup 在默认情况下保持解析的路径不变, 因此解析的路径在 Windows 中会使用 win32 分隔符( \ ),  然而, Rollup 插件会从 <code>@rollup/pluginutils</code> 中使用一个 <a href="https://github.com/rollup/plugins/tree/master/packages/pluginutils#normalizepath" target="_blank" rel="noopener"><code>normalizePath</code> 工具函数</a> ,它在执行比较之前将分隔符转换为 POSIX, 所以意味着当这些插件在 <code>Vite</code> 中使用时, <code>include</code> 和 <code>exclude</code> 两个配置模式, 以及与已解析路径比较相似的路径会正常工作</p>
<p>所以对于 <code>Vite</code>插件来说, 在将路径与已解析的路径进行比较时, 首先规范化路径以使用 POSIX 分隔符是很重要的, 从 <code>vite</code> 模块中也导出了一个等效的 <code>normalizePath</code> 工具函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; normalizePath &#125; <span class="keyword">from</span> <span class="string">'vite'</span></span><br><span class="line">normalizePath(<span class="string">'foo\\bar'</span>) <span class="comment">// 'foo/bar'</span></span><br><span class="line">normalizePath(<span class="string">'foo/bar'</span>) <span class="comment">// 'foo/bar'</span></span><br></pre></td></tr></table></figure>

<h3 id="HMR-API"><a href="#HMR-API" class="headerlink" title="HMR API"></a>HMR API</h3><blockquote>
<p>注意</p>
<p>这里是客户端 HMR API, 若要在插件中处理 HMR 更新, 详见 <code>handleHotUpdate</code></p>
<p>手动 HMR API 主要用于框架和工具作者, 作为最终用户, HMR 可能已经在特定于框架的启动器模板中为你处理过了</p>
</blockquote>
<p>Vite 通过特殊的 <code>import.meta.hot</code> 对象暴露手动 HMR API</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ImportMeta &#123;</span><br><span class="line">  readonly hot?: &#123;</span><br><span class="line">    readonly data: <span class="built_in">any</span></span><br><span class="line"></span><br><span class="line">    accept(): <span class="built_in">void</span></span><br><span class="line">    accept(cb: <span class="function">(<span class="params">mod: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span></span><br><span class="line">    accept(dep: <span class="built_in">string</span>, cb: <span class="function">(<span class="params">mod: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span></span><br><span class="line">    accept(deps: <span class="built_in">string</span>[], cb: <span class="function">(<span class="params">mods: <span class="built_in">any</span>[]</span>) =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line">    dispose(cb: <span class="function">(<span class="params">data: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span></span><br><span class="line">    decline(): <span class="built_in">void</span></span><br><span class="line">    invalidate(): <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line">    on(event: <span class="built_in">string</span>, cb: <span class="function">(<span class="params">...args: <span class="built_in">any</span>[]</span>) =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="必需的条件守卫"><a href="#必需的条件守卫" class="headerlink" title="必需的条件守卫"></a>必需的条件守卫</h4><p>首先, 请确保用一个条件语句守护所有 HMR API 的使用, 这样代码就可以在生产环境中被 tree-shaking 优化</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">import</span>.meta.hot) &#123;</span><br><span class="line">  <span class="comment">// HMR 代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="hot-accept-cb"><a href="#hot-accept-cb" class="headerlink" title="hot.accept(cb)"></a>hot.accept(cb)</h4><p>要接收模块自身, 应使用 <code>import.meta.hot.accept</code>, 参数为接收已更新模块的回调函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动成功后 把1 改成别的 就能触发了</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> count = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">import</span>.meta.hot) &#123;</span><br><span class="line">  <span class="keyword">import</span>.meta.hot!.accept(<span class="function">(<span class="params">newModule</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'updated: count is now '</span>, newModule.count)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createApp(App).mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>

<p>“接受” 热更新的模块被认为是 <strong>HMR 边界</strong> </p>
<p>请注意, <code>Vite</code> 的 HMR 实际上并不替换最初导入的模块: 如果 HMR 边界模块从某个依赖重新导出其导入, 则它负责更新这些重新导出的模块(这些导出必须使用 <code>let</code>), 此外, 边界模块链上的导入者将不会收到更新</p>
<p>这种简化的 HMR 实现对于大多数开发用例来说已经足够了,同时允许我们跳过生成代理模块的昂贵工作</p>
<h4 id="hot-accept-deps-cb"><a href="#hot-accept-deps-cb" class="headerlink" title="hot.accept(deps, cb)"></a>hot.accept(deps, cb)</h4><p>模块也可以接受直接依赖项的更新, 而无需重新加载自身</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bar.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"bar"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// foo.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"foo"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; bar &#125; <span class="keyword">from</span> <span class="string">'./bar'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="string">'./foo'</span>;</span><br><span class="line"></span><br><span class="line">bar();</span><br><span class="line">foo();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">import</span>.meta.hot) &#123;</span><br><span class="line">  <span class="keyword">import</span>.meta.hot!.accept(<span class="string">'./foo.ts'</span>, <span class="function">(<span class="params">newFoo</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 回调函数接收到更新后的'./foo.ts' 模块</span></span><br><span class="line">    newFoo.foo();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 也可以接受一个依赖模块的数组：</span></span><br><span class="line">  <span class="keyword">import</span>.meta.hot!.accept(</span><br><span class="line">    [<span class="string">'./foo.ts'</span>, <span class="string">'./bar.ts'</span>],</span><br><span class="line">    ([newFooModule, newBarModule]) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 回调函数接收一个更新后模块的数组</span></span><br><span class="line">      newFooModule.foo();</span><br><span class="line">      <span class="built_in">console</span>.log(newBarModule) <span class="comment">// 因为我手动改 一次只能改一个文件....</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createApp(App).mount(<span class="string">'#app'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="hot-dispose-cb"><a href="#hot-dispose-cb" class="headerlink" title="hot.dispose(cb)"></a>hot.dispose(cb)</h4><p>一个接收自身的模块或一个期望被其他模块接收的模块可以使用 <code>hot.dispose</code> 来清除任何由其更新副本产生的持久副作用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setupSideEffect</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">setupSideEffect()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">import</span>.meta.hot) &#123;</span><br><span class="line">  <span class="keyword">import</span>.meta.hot.dispose(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 清理副作用</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="hot-data"><a href="#hot-data" class="headerlink" title="hot.data"></a>hot.data</h4><p><code>import.meta.hot.data</code> 对象在同一个更新模块的不同实例之间持久化, 它可以用于将信息从模块的前一个版本传递到下一个版本</p>
<h4 id="hot-decline"><a href="#hot-decline" class="headerlink" title="hot.decline()"></a>hot.decline()</h4><p>调用 <code>import.meta.hot.decline()</code> 表示此模块不可热更新, 如果在传播 HMR 更新时遇到此模块, 浏览器应该执行完全重新加载</p>
<h4 id="hot-invalidate"><a href="#hot-invalidate" class="headerlink" title="hot.invalidate()"></a>hot.invalidate()</h4><p>现在调用 <code>import.meta.hot.invalidate()</code> 只是重新加载页面</p>
<h4 id="hot-on-event-cb"><a href="#hot-on-event-cb" class="headerlink" title="hot.on(event, cb)"></a>hot.on(event, cb)</h4><p>监听自定义 HMR 事件, 自定义 HMR 事件可以由插件发送</p>
<h3 id="JavaScript-API"><a href="#JavaScript-API" class="headerlink" title="JavaScript API"></a>JavaScript API</h3><p>==这部分代码, 能录有限, 测试不来, issue翻烂了都== </p>
<p>Vite 的 JavaScript API 是完全类型化的, 我们推荐使用 TypeScript 或者在 VSCode 中启用 JS 类型检查来利用智能提示和类型校验</p>
<h4 id="createServer"><a href="#createServer" class="headerlink" title="createServer"></a>createServer</h4><p><strong>类型签名</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">createServer</span>(<span class="params">inlineConfig?: InlineConfig</span>): <span class="title">Promise</span>&lt;<span class="title">ViteDevServer</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>使用实例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createServer &#125; = <span class="built_in">require</span>(<span class="string">'vite'</span>)</span><br><span class="line"></span><br><span class="line">;<span class="function">(<span class="params"><span class="keyword">async</span> (</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> server = <span class="keyword">await</span> createServer(&#123;</span><br><span class="line">    <span class="comment">// 任何合法的用户配置选项，加上 `mode` 和 `configFile`</span></span><br><span class="line">    configFile: <span class="literal">false</span>,</span><br><span class="line">    root: __dirname,</span><br><span class="line">    server: &#123;</span><br><span class="line">      port: <span class="number">1337</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">await</span> server.listen()</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h4 id="InlineConfig"><a href="#InlineConfig" class="headerlink" title="InlineConfig"></a>InlineConfig</h4><p><code>InlineConfig</code> 接口扩展了 <code>UserConfig</code> 并添加了以下属性</p>
<ul>
<li><p><code>configFile</code>: 指明要使用的配置文件, 如果没有设置, <code>Vite</code> 将尝试从项目根目录自动解析, 设置为 <code>false</code> 可以禁用自动解析功能</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">declare</span> <span class="keyword">interface</span> InlineConfig <span class="keyword">extends</span> UserConfig &#123;</span><br><span class="line">    configFile?: <span class="built_in">string</span> | <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="ViteDevServer"><a href="#ViteDevServer" class="headerlink" title="ViteDevServer"></a>ViteDevServer</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ViteDevServer &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 被解析的 vite 配置对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  config: ResolvedConfig</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 一个 connect 应用实例</span></span><br><span class="line"><span class="comment">   * - 可以用于将自定义中间件附加到开发服务器。</span></span><br><span class="line"><span class="comment">   * - 还可以用作自定义http服务器的处理函数</span></span><br><span class="line"><span class="comment">      或作为中间件用于任何 connect 风格的 Node.js 框架</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * https://github.com/senchalabs/connect#use-middleware</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  middlewares: Connect.Server</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 本机 node http 服务器实例</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  httpServer: http.Server | <span class="literal">null</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * chokidar 监听器实例</span></span><br><span class="line"><span class="comment">   * https://github.com/paulmillr/chokidar#api</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  watcher: FSWatcher</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * web socket 服务器，带有 `send(payload)` 方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  ws: WebSocketServer</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Rollup 插件容器，可以针对给定文件运行插件钩子</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  pluginContainer: PluginContainer</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 跟踪导入关系、url 到文件映射和 hmr 状态的模块图。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  moduleGraph: ModuleGraph</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 以代码方式解析、加载和转换 url 并获取结果</span></span><br><span class="line"><span class="comment">   * 而不需要通过 http 请求管道。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  transformRequest(</span><br><span class="line">    url: <span class="built_in">string</span>,</span><br><span class="line">    options?: TransformOptions</span><br><span class="line">  ): <span class="built_in">Promise</span>&lt;TransformResult | <span class="literal">null</span>&gt;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 应用 vite 内建 HTML 转换和任意插件 HTML 转换</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  transformIndexHtml(url: <span class="built_in">string</span>, html: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 使用 esbuild 转换一个文件的工具函数</span></span><br><span class="line"><span class="comment">   * 对某些特定插件十分有用</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  transformWithEsbuild(</span><br><span class="line">    code: <span class="built_in">string</span>,</span><br><span class="line">    filename: <span class="built_in">string</span>,</span><br><span class="line">    options?: EsbuildTransformOptions,</span><br><span class="line">    inMap?: object</span><br><span class="line">  ): <span class="built_in">Promise</span>&lt;ESBuildTransformResult&gt;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 加载一个给定的 URL 作为 SSR 的实例化模块</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  ssrLoadModule(</span><br><span class="line">    url: <span class="built_in">string</span>,</span><br><span class="line">    options?: &#123; isolated?: <span class="built_in">boolean</span> &#125;</span><br><span class="line">  ): <span class="built_in">Promise</span>&lt;Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;&gt;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 解决 ssr 错误堆栈信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  ssrFixStacktrace(e: <span class="built_in">Error</span>): <span class="built_in">void</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 启动服务器</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  listen(port?: <span class="built_in">number</span>, isRestart?: <span class="built_in">boolean</span>): <span class="built_in">Promise</span>&lt;ViteDevServer&gt;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 停止服务器</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  close(): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="build"><a href="#build" class="headerlink" title="build"></a>build</h4><p><strong>类型校验</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">build</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  inlineConfig?: InlineConfig</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">RollupOutput</span> | <span class="title">RollupOutput</span>[]&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>使用示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; build &#125; = <span class="built_in">require</span>(<span class="string">'vite'</span>)</span><br><span class="line"></span><br><span class="line">;<span class="function">(<span class="params"><span class="keyword">async</span> (</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> build(&#123;</span><br><span class="line">    root: path.resolve(__dirname, <span class="string">'./project'</span>),</span><br><span class="line">    build: &#123;</span><br><span class="line">      base: <span class="string">'/foo/'</span>,</span><br><span class="line">      rollupOptions: &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h4 id="resolveConfig"><a href="#resolveConfig" class="headerlink" title="resolveConfig"></a>resolveConfig</h4><p><strong>类型校验</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">resolveConfig</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  inlineConfig: InlineConfig,</span></span></span><br><span class="line"><span class="function"><span class="params">  command: 'build' | 'serve',</span></span></span><br><span class="line"><span class="function"><span class="params">  defaultMode?: <span class="built_in">string</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">ResolvedConfig</span>&gt;</span></span><br></pre></td></tr></table></figure>


</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Decade W</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.decade.run/2021/04/09/vite-%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0/">http://blog.decade.run/2021/04/09/vite-%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.decade.run" target="_blank">王小明</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/learn/">learn</a><a class="post-meta__tags" href="/tags/vite/">vite</a></div><div class="post_share"><div class="social-share" data-image="/img/coverimg/vue.jpg" data-sites="twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2021/04/06/vue3-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E4%B8%80/"><img class="next_cover lazyload" data-src="/img/coverimg/vue.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">vue3 源码阅读(一)</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/13/Hello-myBlog/" title="Hello myBlog"><img class="relatedPosts_cover lazyload"data-src="/img/hellomyblog/d2.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-13</div><div class="relatedPosts_title">Hello myBlog</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/19/data-structure/" title="数据结构与算法"><img class="relatedPosts_cover lazyload"data-src="/img/learn/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-19</div><div class="relatedPosts_title">数据结构与算法</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/19/ds2/" title="javascript执行上下文与执行栈"><img class="relatedPosts_cover lazyload"data-src="/img/learn/2.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-19</div><div class="relatedPosts_title">javascript执行上下文与执行栈</div></div></a></div><div class="relatedPosts_item"><a href="/2020/11/09/element-ui-3-源码学习-4/" title="element-ui-3-源码学习-4"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-11-09</div><div class="relatedPosts_title">element-ui-3-源码学习-4</div></div></a></div><div class="relatedPosts_item"><a href="/2020/11/05/element-ui-3-源码学习-3/" title="element-ui-3-源码学习-3"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-11-05</div><div class="relatedPosts_title">element-ui-3-源码学习-3</div></div></a></div><div class="relatedPosts_item"><a href="/2020/09/02/hook-in-vue3-0-1/" title="hook in vue3.0"><img class="relatedPosts_cover lazyload"data-src="/img/coverimg/vue.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-09-02</div><div class="relatedPosts_title">hook in vue3.0</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  appId: 'WzoNQ79zXHpLGhYhAiHrDU9m-gzGzoHsz',
  appKey: 'Nhmax4ME4ul4BPqWy3GGqIFq',
  placeholder: 'Please leave your footprints',
  avatar: '',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: true,
  serverURLs: '',
  mathjax: false
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Decade W</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi,  welcome  to  my  <a  href="http://blog.decade.run/">blog</a>!</div><div class="icp"><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>互联网ICP备案:渝ICP备19015868号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Search</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="canvas_nest" color="106,90,205" opacity="0.7" zIndex="-1" count="199" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/ClickShowText.js"></script><script src="/js/search/algolia.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script><div class="waifu"><div class="hide-button">隐藏</div><div class="waifu-tips"></div><canvas class="live2d" id="live2d" width="200" height="300"></canvas></div><script src="/lib/waifu-tips.js" async></script><script src="/lib/live2d.js"></script><script src="/lib/run.js"></script></body></html>